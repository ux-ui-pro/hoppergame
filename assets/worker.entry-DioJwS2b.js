(function(){"use strict";const F={obstacles:{intervalMinSec:1,intervalMaxSec:1.9,skeletonInNegativeProb:.35},heart:{baseProb:.01,minGapObs:9,maxGapObs:15},coin:{intervalMinSec:1.5,intervalMaxSec:3},scaling:{targetSec:180,minMultiplier:.4,minSafeGapSec:.7,coinFullScale:100,coinFactor:.25,streakFullSec:30,streakFactor:.125,relax:{whenLifeLE:1,recentHitSecs:5,relaxMultiplier:1.15},rest:{whenMultiplierLE:.7,probability:.4,gapMultiplier:4,cooldownSec:5}}},A=600-50,O=240,j=720/(1/3),G=720,B=F.obstacles.intervalMinSec,Y=F.obstacles.intervalMaxSec,ne=F.heart.baseProb,ie=F.heart.minGapObs,re=F.heart.maxGapObs,le=F.obstacles.skeletonInNegativeProb,L=F.coin.intervalMinSec,z=F.coin.intervalMaxSec,V=3072,q=3072,N={hitboxW:20,hitboxH:60,visualHeight:80,offsetX:5},_={blight:{hitboxW:30,hitboxH:40,visualHeight:80,offsetX:4,offsetY:0},skeleton:{hitboxW:20,hitboxH:60,visualHeight:80,offsetX:-7,offsetY:0},heart:{hitboxW:16,hitboxH:16,visualHeight:80,offsetX:0,offsetY:28},coin:{hitboxW:24,hitboxH:24,visualHeight:80,offsetX:0,offsetY:30}},oe=160;function K(e,a){let f=e;if(!f.startsWith("data:")){const H=new URL(f);H.searchParams.set("v",a),f=H.toString()}return f}const ce=new URL("./runner-sprite-sheet-DHgMcSOn.webp",self.location.href),se=new URL("./runner-sprite-sheet-BAre8VZS.json",self.location.href),i={ctx:null,canvas:null,cssW:0,cssH:0,scale:1,transparentBg:!1,ready:!1,expectResize:!1,readyTimer:null,score:0,coinCount:0,lifeCount:3,uiDirty:!0,uiElapsedMs:0,uiIntervalMs:120,elapsedSec:0,noHitSec:0,recentHitCooldownSec:0,restCooldownSec:0,player:{x:0,y:A-N.hitboxH,width:N.hitboxW,height:N.hitboxH,vy:0,isJumping:!1},entities:[],spawnTimerSec:0,sinceLastOnigiriCount:0,nextSpawnSec:B+Math.random()*(Y-B),pendingJump:!1,coinSpawnTimerSec:0,coinNextSpawnSec:0,skyColor:"#e0f7fa",debugDrawHitboxes:!1,playerSpriteUrl:K(ce.toString(),"3"),playerAtlasUrl:K(se.toString(),"3"),playerSprite:null,playerAtlas:null,playerSpriteLoading:!1,playerRunFrames:[],playerJumpFrames:[],playerHitFrames:[],playerRewardFrames:[],playerDyingFrames:[],blightFrames:[],heartFrames:[],coinFrameName:null,coinFrames:[],blightAnimElapsedMs:0,blightAnimFrameIndex:0,skeletonFrames:[],heartAnimElapsedMs:0,heartAnimFrameIndex:0,coinAnimElapsedMs:0,coinAnimFrameIndex:0,skeletonAnimElapsedMs:0,skeletonAnimFrameIndex:0,playerAnimFps:12,playerAnimFrameMs:1e3/12,playerAnimElapsedMs:0,playerAnimFrameIndex:0,playerRunStartIndexAtJump:0,playerRunPhaseMsDuringJump:0,playerJumpElapsedMs:0,playerJumpTotalMs:2*Math.abs(G)/Math.abs(j)*1e3,playerHitPlaying:!1,playerHitElapsedMs:0,playerHitFrameIndex:0,playerRewardPlaying:!1,playerRewardElapsedMs:0,playerRewardFrameIndex:0,isDying:!1,dyingElapsedMs:0,dyingDurationMs:2e3,gameOverSent:!1,playerDyingPlaying:!1,playerDyingElapsedMs:0,playerDyingFrameIndex:0,prevPlayerY:A-N.hitboxH};function Q(e,a,f,H){e.cssW=Math.max(1,Math.floor(a)),e.cssH=Math.max(1,Math.floor(f));const r=Math.max(H||1,1),o=Math.max(1,e.cssW*e.cssH),n=V*q,h=Math.max(1,Math.sqrt(n/o)),c=e.cssW>=1024||e.cssH>=1024?2:3,x=(C=>Math.max(1,Math.round(C/.25)*.25))(Math.min(r,h,c)),m=V/e.cssW,p=q/e.cssH;let y="dpr",g=x;m<g&&(g=m,y="w"),p<g&&(g=p,y="h"),e.scale=Math.max(1/8,g);let M=0,b=0;y==="h"?(b=Math.max(1,Math.floor(e.cssH*e.scale)),M=Math.max(1,Math.round(b*(e.cssW/e.cssH)))):y==="w"?(M=Math.max(1,Math.floor(e.cssW*e.scale)),b=Math.max(1,Math.round(M*(e.cssH/e.cssW)))):(M=Math.max(1,Math.round(e.cssW*e.scale)),b=Math.max(1,Math.round(e.cssH*e.scale))),!(!e.canvas||!e.ctx)&&(e.canvas.width!==M&&(e.canvas.width=M),e.canvas.height!==b&&(e.canvas.height=b),e.player.x=e.cssW*.14)}function pe(e,a){if(!e.ctx)return;e.prevPlayerY=e.player.y,e.elapsedSec+=a,e.noHitSec+=a,e.recentHitCooldownSec>0&&(e.recentHitCooldownSec=Math.max(0,e.recentHitCooldownSec-a)),e.restCooldownSec>0&&(e.restCooldownSec=Math.max(0,e.restCooldownSec-a));function f(r){const o=Math.max(0,Math.min(1,r));return o<.5?2*o*o:1-Math.pow(-2*o+2,2)/2}function H(){const r=F.scaling,o=Math.max(0,Math.min(1,e.elapsedSec/r.targetSec)),n=1-(1-r.minMultiplier)*f(o),h=1-r.coinFactor*Math.max(0,Math.min(1,e.coinCount/r.coinFullScale)),c=1-r.streakFactor*Math.max(0,Math.min(1,e.noHitSec/r.streakFullSec));let s=n*h*c;return s=Math.max(r.minMultiplier,Math.min(1,s)),(e.lifeCount<=r.relax.whenLifeLE||e.recentHitCooldownSec>0)&&(s*=r.relax.relaxMultiplier),Math.max(.4,Math.min(1.3,s))}if(e.isDying)e.pendingJump=!1,e.player.isJumping=!1,e.player.vy=0,e.player.y=A-e.player.height;else if(!e.player.isJumping&&e.pendingJump){e.player.isJumping=!0,e.player.vy=-G,e.pendingJump=!1;try{postMessage({type:"sfx",s:"jump"})}catch{}e.playerRunStartIndexAtJump=e.playerAnimFrameIndex,e.playerRunPhaseMsDuringJump=0,e.playerJumpElapsedMs=0}if(!e.isDying&&e.player.isJumping&&(e.player.vy+=j*a,e.player.y+=e.player.vy*a,e.playerRunPhaseMsDuringJump+=a*1e3,e.playerJumpElapsedMs=Math.min(e.playerJumpTotalMs,e.playerJumpElapsedMs+a*1e3),e.player.y>=A-e.player.height&&(e.player.y=A-e.player.height,e.player.vy=0,e.player.isJumping=!1,e.playerJumpElapsedMs=e.playerJumpTotalMs,e.playerRunFrames.length>0&&(e.playerAnimFrameIndex=0,e.playerAnimElapsedMs=0),e.playerRunPhaseMsDuringJump=0)),e.playerSprite&&e.playerAtlas){if(e.isDying&&e.playerDyingFrames&&e.playerDyingFrames.length>0)for(e.playerDyingElapsedMs+=a*1e3;e.playerDyingElapsedMs>=e.playerAnimFrameMs;)if(e.playerDyingElapsedMs-=e.playerAnimFrameMs,e.playerDyingFrameIndex+1<e.playerDyingFrames.length)e.playerDyingFrameIndex+=1;else{e.playerDyingPlaying=!1,e.playerDyingFrameIndex=e.playerDyingFrames.length-1;break}else if(e.playerRewardPlaying&&e.playerRewardFrames.length>0)for(e.playerRewardElapsedMs+=a*1e3;e.playerRewardElapsedMs>=e.playerAnimFrameMs;)if(e.playerRewardElapsedMs-=e.playerAnimFrameMs,e.playerRewardFrameIndex+1<e.playerRewardFrames.length)e.playerRewardFrameIndex+=1;else{e.playerRewardPlaying=!1,e.playerRewardFrameIndex=e.playerRewardFrames.length-1;break}else if(e.playerHitPlaying&&e.playerHitFrames.length>0)for(e.playerHitElapsedMs+=a*1e3;e.playerHitElapsedMs>=e.playerAnimFrameMs;)if(e.playerHitElapsedMs-=e.playerAnimFrameMs,e.playerHitFrameIndex+1<e.playerHitFrames.length)e.playerHitFrameIndex+=1;else{e.playerHitPlaying=!1,e.playerHitFrameIndex=e.playerHitFrames.length-1;break}else if(e.playerRunFrames.length>0)if(e.player.isJumping)e.playerAnimFrameIndex=0,e.playerAnimElapsedMs=0;else for(e.playerAnimElapsedMs+=a*1e3;e.playerAnimElapsedMs>=e.playerAnimFrameMs;)e.playerAnimElapsedMs-=e.playerAnimFrameMs,e.playerAnimFrameIndex=(e.playerAnimFrameIndex+1)%e.playerRunFrames.length}if(!e.isDying&&e.coinFrames.length>0)for(e.coinAnimElapsedMs+=a*1e3;e.coinAnimElapsedMs>=e.playerAnimFrameMs;)e.coinAnimElapsedMs-=e.playerAnimFrameMs,e.coinAnimFrameIndex=(e.coinAnimFrameIndex+1)%e.coinFrames.length;if(!e.isDying&&e.heartFrames.length>0)for(e.heartAnimElapsedMs+=a*1e3;e.heartAnimElapsedMs>=e.playerAnimFrameMs;)e.heartAnimElapsedMs-=e.playerAnimFrameMs,e.heartAnimFrameIndex=(e.heartAnimFrameIndex+1)%e.heartFrames.length;if(!e.isDying&&e.skeletonFrames.length>0)for(e.skeletonAnimElapsedMs+=a*1e3;e.skeletonAnimElapsedMs>=e.playerAnimFrameMs;)e.skeletonAnimElapsedMs-=e.playerAnimFrameMs,e.skeletonAnimFrameIndex=(e.skeletonAnimFrameIndex+1)%e.skeletonFrames.length;if(!e.isDying&&e.blightFrames&&e.blightFrames.length>0)for(e.blightAnimElapsedMs+=a*1e3;e.blightAnimElapsedMs>=e.playerAnimFrameMs;)e.blightAnimElapsedMs-=e.playerAnimFrameMs,e.blightAnimFrameIndex=(e.blightAnimFrameIndex+1)%e.blightFrames.length;if(e.isDying||(e.spawnTimerSec+=a),!e.isDying&&e.spawnTimerSec>=e.nextSpawnSec){const r=H(),o=Math.random();let n;if(e.sinceLastOnigiriCount<ie?n="negative":e.sinceLastOnigiriCount>=re?n="collectible":n=o<ne?"collectible":"negative",n==="negative"||e.lifeCount>=3){const y=Math.max(0,Math.min(1,e.elapsedSec/F.scaling.targetSec)),g=Math.max(0,Math.min(.95,le+.35*y)),M=Math.random()<g,b=Math.max(.1,(e.playerJumpTotalMs||0)/1e3),C=Math.max(F.scaling.minSafeGapSec,.6*b),S=Math.max(20,Math.round(O*C));let d=null;for(let l=e.entities.length-1;l>=0;l--){const u=e.entities[l];if(u.kind==="blight"||u.kind==="skeleton"){d=u;break}}const v=Math.max(S,((d==null?void 0:d.width)??0)+12),D=Math.max(e.cssW,d?d.x+v:e.cssW);if(M){const l=_.skeleton;e.entities.push({x:D,y:A-l.hitboxH,width:l.hitboxW,height:l.hitboxH,kind:"skeleton"})}else{const l=_.blight;e.entities.push({x:D,y:A-l.hitboxH,width:l.hitboxW,height:l.hitboxH,kind:"blight"})}if(e.sinceLastOnigiriCount+=1,(()=>{const l=F.scaling,u=Math.max(0,Math.min(1,e.elapsedSec/l.targetSec)),E=u<.5?2*u*u:1-Math.pow(-2*u+2,2)/2,I=1-(1-l.minMultiplier)*E,R=1-l.coinFactor*Math.max(0,Math.min(1,e.coinCount/l.coinFullScale)),k=1-l.streakFactor*Math.max(0,Math.min(1,e.noHitSec/l.streakFullSec));let w=I*R*k;return w=Math.max(l.minMultiplier,Math.min(1,w)),(e.lifeCount<=l.relax.whenLifeLE||e.recentHitCooldownSec>0)&&(w*=l.relax.relaxMultiplier),Math.max(.4,Math.min(1.3,w))})()<=.5&&Math.random()<.25){const l=e.entities[e.entities.length-1],u=Math.max(.1,(e.playerJumpTotalMs||0)/1e3),E=Math.max(F.scaling.minSafeGapSec,.6*u)*1.2,I=Math.max(20,Math.round(O*E)),R=Math.max(I,((l==null?void 0:l.width)??0)+16),k=(l?l.x:e.cssW)+R;let w=Math.random()<g;if(l&&l.kind==="skeleton"&&w&&(w=!1),l&&l.kind==="blight"&&!w&&(w=!0),w){const t=_.skeleton;e.entities.push({x:k,y:A-t.hitboxH,width:t.hitboxW,height:t.hitboxH,kind:"skeleton"})}else{const t=_.blight;e.entities.push({x:k,y:A-t.hitboxH,width:t.hitboxW,height:t.hitboxH,kind:"blight"})}}}else{const y=_.heart;e.entities.push({x:e.cssW,y:A-y.hitboxH,width:y.hitboxW,height:y.hitboxH,kind:"heart"}),e.sinceLastOnigiriCount=0}e.spawnTimerSec=0;const h=F.scaling,c=B*r,s=Y*r,x=c+Math.random()*Math.max(0,s-c);let m=Math.max(h.minSafeGapSec,x);const p=h.rest;if(e.restCooldownSec<=0&&r<=p.whenMultiplierLE&&Math.random()<p.probability){const y=Math.max(h.minSafeGapSec,h.minSafeGapSec*p.gapMultiplier);m=Math.max(m,y),e.restCooldownSec=p.cooldownSec}e.nextSpawnSec=m}if(e.isDying||(e.coinSpawnTimerSec+=a),!e.isDying&&e.coinNextSpawnSec<=0&&(e.coinNextSpawnSec=L+Math.random()*(z-L)),!e.isDying&&e.coinSpawnTimerSec>=e.coinNextSpawnSec){const r=_.coin,o=r.hitboxH,n=G*G/(2*Math.abs(j)),h=Math.max(0,A-n),c=Math.max(0,h-o);e.entities.push({x:e.cssW,y:c,width:r.hitboxW,height:o,kind:"coin"}),e.coinSpawnTimerSec=0,e.coinNextSpawnSec=L+Math.random()*(z-L)}if(!e.isDying)for(let r=e.entities.length-1;r>=0;r--){const o=e.entities[r];if(o.x-=O*a,o.x+o.width<0){e.entities.splice(r,1);continue}if(o.x<e.player.x+e.player.width&&o.x+o.width>e.player.x&&o.y<e.player.y+e.player.height&&o.y+o.height>e.player.y){if(e.isDying)continue;if(o.kind==="heart"||o.kind==="coin"){if(e.entities.splice(r,1),o.kind==="coin"?(e.coinCount+=1,e.uiDirty=!0):o.kind==="heart"&&e.lifeCount<3&&(e.lifeCount+=1,e.uiDirty=!0),o.kind==="coin")try{postMessage({type:"sfx",s:"coin"})}catch{}else if(o.kind==="heart")try{postMessage({type:"sfx",s:"heart"})}catch{}e.playerRewardFrames.length>0&&(e.playerRewardPlaying=!0,e.playerRewardElapsedMs=0,e.playerRewardFrameIndex=0)}else{if(e.entities.splice(r,1),e.lifeCount>0&&(e.lifeCount-=1,e.uiDirty=!0),e.noHitSec=0,e.recentHitCooldownSec=Math.max(e.recentHitCooldownSec,F.scaling.relax.recentHitSecs),o.kind==="blight")try{postMessage({type:"sfx",s:"blight"})}catch{}else if(o.kind==="skeleton")try{postMessage({type:"sfx",s:"skeleton"})}catch{}if(e.lifeCount<=0&&!e.isDying){e.isDying=!0,e.dyingElapsedMs=0,e.gameOverSent=!1,e.pendingJump=!1,e.player.isJumping=!1,e.player.vy=0,e.player.y=A-e.player.height,e.playerHitPlaying=!1,e.playerRewardPlaying=!1;try{postMessage({type:"death"})}catch{}e.playerDyingFrames.length>0&&(e.playerDyingPlaying=!0,e.playerDyingElapsedMs=0,e.playerDyingFrameIndex=0)}else e.playerHitFrames.length>0&&(e.playerHitPlaying=!0,e.playerHitElapsedMs=0,e.playerHitFrameIndex=0)}}}if(e.isDying&&(e.dyingElapsedMs+=a*1e3,!e.gameOverSent&&e.dyingElapsedMs>=e.dyingDurationMs)){e.gameOverSent=!0;try{postMessage({type:"gameover"})}catch{}}}async function me(e){var a,f;if(e.ctx&&!(e.playerSprite||e.playerAtlas||e.playerSpriteLoading)&&!(!e.playerSpriteUrl||!e.playerAtlasUrl)){e.playerSpriteLoading=!0;try{const[H,r]=await Promise.all([fetch(e.playerSpriteUrl),fetch(e.playerAtlasUrl)]);if(!H.ok)throw new Error("Failed to fetch player sprite");if(!r.ok)throw new Error("Failed to fetch player atlas");const[o,n]=[await H.blob(),await r.json()],h=await createImageBitmap(o),c=(t,X)=>{var ae,te;const $=((ae=t[1].frame)==null?void 0:ae.x)??0,ee=((te=X[1].frame)==null?void 0:te.x)??0;if($!==ee)return $-ee;const ge=parseInt(t[0].split("_")[1]||"0",10),fe=parseInt(X[0].split("_")[1]||"0",10);return ge-fe},s=n.frames||{},x=Object.entries(s).filter(([t])=>t.startsWith("run_")).sort(c),m=Object.entries(s).filter(([t])=>t.startsWith("jump_")).sort(c),p=Object.entries(s).filter(([t])=>t.startsWith("hit_")).sort(c),y=Object.entries(s).filter(([t])=>t.startsWith("dying_")).sort(c),g=Object.entries(s).filter(([t])=>t.startsWith("blight_")).sort(c),M=Object.entries(s).filter(([t])=>t.startsWith("heart_")).sort(c),b=Object.entries(s).filter(([t])=>t.startsWith("coin_")).sort(c),C=Object.entries(s).filter(([t])=>t.startsWith("skeleton_")).sort(c),S=t=>(t||[]).filter(X=>!!s[X]),d=n.animations||{};let v=S(d.run),D=S(d.jump),W=S(d.hit),l=S(d.reward),u=S(d.dying),E=S(d.blight),I=S(d.heart),R=(a=S(d.coin))==null?void 0:a[0],k=S(d.coin),w=S(d.skeleton);(!v||v.length===0)&&(v=x.map(([t])=>t)),(!D||D.length===0)&&(D=m.map(([t])=>t)),(!W||W.length===0)&&(W=p.map(([t])=>t)),(!l||l.length===0)&&(l=Object.keys(s).filter(t=>t.startsWith("reward_")).sort().map(t=>t)),(!u||u.length===0)&&(u=y.map(([t])=>t)),(!E||E.length===0)&&(E=g.map(([t])=>t)),(!I||I.length===0)&&(I=M.map(([t])=>t)),R||(R=(f=b[0])==null?void 0:f[0]),(!k||k.length===0)&&(k=b.map(([t])=>t)),(!w||w.length===0)&&(w=C.map(([t])=>t)),e.playerRunFrames=v,e.playerJumpFrames=D,e.playerHitFrames=W,e.playerRewardFrames=l,e.playerDyingFrames=u,e.blightFrames=E||[],e.heartFrames=I||[],e.coinFrameName=R??null,e.coinFrames=k||[],e.skeletonFrames=w||[],e.playerSprite=h,e.playerAtlas=n}finally{e.playerSpriteLoading=!1}}}function he(e,a=1,f=1/60){if(!e.ctx||!e.canvas)return;e.transparentBg?e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height):(e.ctx.fillStyle=e.skyColor,e.ctx.fillRect(0,0,e.canvas.width,e.canvas.height));const H=e.cssH-oe,r=Math.round((H-A)*e.scale),o=e.prevPlayerY+(e.player.y-e.prevPlayerY)*a;if(me(e),e.playerSprite&&e.playerAtlas){let n=null;if(e.isDying&&e.playerDyingFrames&&e.playerDyingFrames.length>0)n=e.playerDyingFrames[Math.max(0,Math.min(e.playerDyingFrames.length-1,e.playerDyingFrameIndex))]||null;else if(e.playerRewardPlaying&&e.playerRewardFrames.length>0)n=e.playerRewardFrames[Math.max(0,Math.min(e.playerRewardFrames.length-1,e.playerRewardFrameIndex))]||null;else if(e.playerHitPlaying&&e.playerHitFrames.length>0)n=e.playerHitFrames[Math.max(0,Math.min(e.playerHitFrames.length-1,e.playerHitFrameIndex))]||null;else if(e.player.isJumping&&e.playerJumpFrames.length>0){const x=e.playerJumpTotalMs||1,m=Math.max(0,Math.min(1,e.playerJumpElapsedMs/x)),p=.1;if(m<p&&e.playerRunFrames.length>0)n=e.playerRunFrames[Math.max(0,Math.min(e.playerRunFrames.length-1,e.playerRunStartIndexAtJump))];else{const y=Math.max(0,Math.min(1,(m-p)/(1-p))),g=e.playerJumpFrames.length,M=Math.max(0,Math.min(g-1,Math.floor(y*(g-1)+1e-6)));n=e.playerJumpFrames[M]}}else e.playerRunFrames.length>0&&(n=e.playerRunFrames[Math.max(0,Math.min(e.playerRunFrames.length-1,e.playerAnimFrameIndex))]);const h=n?e.playerAtlas.frames[n]:void 0,c=h==null?void 0:h.frame,s=(h==null?void 0:h.pivot)||{x:.5,y:1};if(c){const x=N.visualHeight,m=c.w/c.h*x,p=e.player.x-s.x*m+N.offsetX,g=o+e.player.height+0-x*s.y,M=Math.round(p*e.scale),b=Math.round(g*e.scale+r),C=Math.max(1,Math.round(m*e.scale)),S=Math.max(1,Math.round(x*e.scale)),d=e.ctx.imageSmoothingEnabled;e.ctx.imageSmoothingEnabled=!1,e.ctx.drawImage(e.playerSprite,c.x,c.y,c.w,c.h,M,b,C,S),e.ctx.imageSmoothingEnabled=d}}else e.ctx.fillStyle="#000",e.ctx.fillRect(Math.round(e.player.x*e.scale),Math.round(o*e.scale+r),Math.round(e.player.width*e.scale),Math.round(e.player.height*e.scale));if(e.debugDrawHitboxes){const n=Math.round(e.player.x*e.scale),h=Math.round(o*e.scale+r),c=Math.round(e.player.width*e.scale),s=Math.round(e.player.height*e.scale);e.ctx.save(),e.ctx.globalAlpha=.3,e.ctx.fillStyle="#ff00ff",e.ctx.fillRect(n,h,c,s),e.ctx.globalAlpha=1,e.ctx.lineWidth=Math.max(1,Math.round(e.scale)),e.ctx.strokeStyle="#ff00ff",e.ctx.strokeRect(n,h,c,s),e.ctx.restore()}if(!e.isDying)for(const n of e.entities){const c=n.x+O*f*(1-a),s=n.y;if(e.playerSprite&&e.playerAtlas&&(n.kind==="blight"||n.kind==="skeleton"||n.kind==="heart"||n.kind==="coin")){const x=n.kind==="blight"?e.blightFrames.length>0?e.blightFrames[Math.max(0,Math.min(e.blightFrames.length-1,e.blightAnimFrameIndex))]:null:n.kind==="skeleton"?e.skeletonFrames.length>0?e.skeletonFrames[Math.max(0,Math.min(e.skeletonFrames.length-1,e.skeletonAnimFrameIndex))]:null:n.kind==="heart"?e.heartFrames.length>0?e.heartFrames[Math.max(0,Math.min(e.heartFrames.length-1,e.heartAnimFrameIndex))]:null:e.coinFrames.length>0?e.coinFrames[Math.max(0,Math.min(e.coinFrames.length-1,e.coinAnimFrameIndex))]:e.coinFrameName,m=x?e.playerAtlas.frames[x]:void 0,p=m==null?void 0:m.frame,y=(m==null?void 0:m.pivot)||{x:.5,y:1};if(p){const g=_[n.kind],M=g.visualHeight,b=p.w/p.h*M,C=c-y.x*b+n.width*.5+(g.offsetX||0),d=s+n.height+(g.offsetY||0)-M*y.y,v=Math.round(C*e.scale),D=Math.round(d*e.scale+r),W=Math.max(1,Math.round(b*e.scale)),l=Math.max(1,Math.round(M*e.scale)),u=e.ctx.imageSmoothingEnabled;if(e.ctx.imageSmoothingEnabled=!1,e.ctx.drawImage(e.playerSprite,p.x,p.y,p.w,p.h,v,D,W,l),e.ctx.imageSmoothingEnabled=u,e.debugDrawHitboxes){const E=Math.round(c*e.scale),I=Math.round(s*e.scale+r),R=Math.round(n.width*e.scale),k=Math.round(n.height*e.scale);e.ctx.save(),e.ctx.globalAlpha=.3,e.ctx.fillStyle="#ff00ff",e.ctx.fillRect(E,I,R,k),e.ctx.globalAlpha=1,e.ctx.lineWidth=Math.max(1,Math.round(e.scale)),e.ctx.strokeStyle="#ff00ff",e.ctx.strokeRect(E,I,R,k),e.ctx.restore()}continue}}if(e.ctx.fillStyle=n.kind==="heart"?"#0a0":n.kind==="coin"?"#fc0":"red",e.ctx.fillRect(Math.round(c*e.scale),Math.round(s*e.scale+r),Math.round(n.width*e.scale),Math.round(n.height*e.scale)),e.debugDrawHitboxes){const x=Math.round(c*e.scale),m=Math.round(s*e.scale+r),p=Math.round(n.width*e.scale),y=Math.round(n.height*e.scale);e.ctx.save(),e.ctx.globalAlpha=.3,e.ctx.fillStyle="#ff00ff",e.ctx.fillRect(x,m,p,y),e.ctx.globalAlpha=1,e.ctx.lineWidth=Math.max(1,Math.round(e.scale)),e.ctx.strokeStyle="#ff00ff",e.ctx.strokeRect(x,m,p,y),e.ctx.restore()}}}function U(){i.ready||(i.ready=!0,postMessage({type:"ready"}))}let P=0,T=0;const J=1e3/60,Z=100,ye=5;function de(e){if(!i.ready)return;P||(P=e);let a=e-P;P=e,a<0&&(a=0),a>Z&&(a=Z),T+=a;let f=0;for(;T>=J&&f<ye;)pe(i,J/1e3),T-=J,f++;i.uiElapsedMs+=a,i.uiDirty&&i.uiElapsedMs>=i.uiIntervalMs&&(postMessage({type:"ui",coinCount:i.coinCount,lifeCount:i.lifeCount}),i.uiDirty=!1,i.uiElapsedMs=0);const H=Math.max(0,Math.min(1,T/J));he(i,H,J/1e3)}onmessage=e=>{const a=e.data||{};switch(a.type){case"init":{i.canvas=a.canvas,i.skyColor=typeof a.skyColor=="string"?a.skyColor:i.skyColor,i.expectResize=!!a.expectResize,i.debugDrawHitboxes=!!a.debugHitboxes;const f=!!a.alpha;if(i.ctx=i.canvas.getContext("2d",{alpha:f}),!i.ctx)return;i.ctx.imageSmoothingEnabled=!1,i.transparentBg=!!a.transparentBg,Q(i,a.cssW,a.cssH,a.dpr),i.expectResize?(i.readyTimer&&clearTimeout(i.readyTimer),i.readyTimer=setTimeout(()=>{U()},200)):U();break}case"resize":{Q(i,a.cssW,a.cssH,a.dpr),i.expectResize&&(i.expectResize=!1,i.readyTimer&&(clearTimeout(i.readyTimer),i.readyTimer=null),U());break}case"frame":{de(typeof a.now=="number"?a.now:performance.now());break}case"vis":{P=0,T=0;break}case"input":{(a.tap||a.space)&&!i.isDying&&i.lifeCount>0&&!i.player.isJumping&&(i.pendingJump=!0);break}}}})();
//# sourceMappingURL=worker.entry-DioJwS2b.js.map
