(function(){"use strict";const b={obstacles:{intervalMinSec:1,intervalMaxSec:1.9,skeletonInNegativeProb:.35},heart:{baseProb:.01,minGapObs:9,maxGapObs:15},coin:{intervalMinSec:1.5,intervalMaxSec:3},scaling:{targetSec:180,minMultiplier:.4,minSafeGapSec:.7,coinFullScale:100,coinFactor:.25,streakFullSec:30,streakFactor:.125,relax:{whenLifeLE:1,recentHitSecs:5,relaxMultiplier:1.15},rest:{whenMultiplierLE:.7,probability:.4,gapMultiplier:4,cooldownSec:5}}},H=600-50,G=240,X=720/(1/3),D=720,j=b.obstacles.intervalMinSec,B=b.obstacles.intervalMaxSec,te=b.heart.baseProb,ae=b.heart.minGapObs,ne=b.heart.maxGapObs,ie=b.obstacles.skeletonInNegativeProb,L=b.coin.intervalMinSec,U=b.coin.intervalMaxSec,z=3072,V=3072,T={hitboxW:20,hitboxH:60,visualHeight:80,offsetX:5},_={blight:{hitboxW:30,hitboxH:40,visualHeight:80,offsetX:4,offsetY:0},skeleton:{hitboxW:20,hitboxH:60,visualHeight:80,offsetX:-7,offsetY:0},heart:{hitboxW:16,hitboxH:16,visualHeight:80,offsetX:0,offsetY:28},coin:{hitboxW:24,hitboxH:24,visualHeight:80,offsetX:0,offsetY:30}},re=160;function q(e,t){let f=e;if(!f.startsWith("data:")){const k=new URL(f);k.searchParams.set("v",t),f=k.toString()}return f}const le=new URL("./runner-sprite-sheet-DtfMcDYK.webp",self.location.href),oe=new URL("./runner-sprite-sheet-BYwRWmd0.json",self.location.href),o={ctx:null,canvas:null,cssW:0,cssH:0,scale:1,transparentBg:!1,ready:!1,expectResize:!1,readyTimer:null,score:0,coinCount:0,lifeCount:3,uiDirty:!0,uiElapsedMs:0,uiIntervalMs:120,elapsedSec:0,noHitSec:0,recentHitCooldownSec:0,restCooldownSec:0,player:{x:0,y:H-T.hitboxH,width:T.hitboxW,height:T.hitboxH,vy:0,isJumping:!1},entities:[],spawnTimerSec:0,sinceLastOnigiriCount:0,nextSpawnSec:j+Math.random()*(B-j),pendingJump:!1,coinSpawnTimerSec:0,coinNextSpawnSec:0,skyColor:"#e0f7fa",debugDrawHitboxes:!1,playerSpriteUrl:q(le.toString(),"3"),playerAtlasUrl:q(oe.toString(),"3"),playerSprite:null,playerAtlas:null,playerSpriteLoading:!1,playerRunFrames:[],playerJumpFrames:[],playerHitFrames:[],playerRewardFrames:[],blightFrames:[],heartFrames:[],coinFrameName:null,coinFrames:[],blightAnimElapsedMs:0,blightAnimFrameIndex:0,skeletonFrames:[],heartAnimElapsedMs:0,heartAnimFrameIndex:0,coinAnimElapsedMs:0,coinAnimFrameIndex:0,skeletonAnimElapsedMs:0,skeletonAnimFrameIndex:0,playerAnimFps:12,playerAnimFrameMs:1e3/12,playerAnimElapsedMs:0,playerAnimFrameIndex:0,playerRunStartIndexAtJump:0,playerRunPhaseMsDuringJump:0,playerJumpElapsedMs:0,playerJumpTotalMs:2*Math.abs(D)/Math.abs(X)*1e3,playerHitPlaying:!1,playerHitElapsedMs:0,playerHitFrameIndex:0,playerRewardPlaying:!1,playerRewardElapsedMs:0,playerRewardFrameIndex:0,prevPlayerY:H-T.hitboxH};function K(e,t,f,k){e.cssW=Math.max(1,Math.floor(t)),e.cssH=Math.max(1,Math.floor(f));const i=Math.max(k||1,1),l=Math.max(1,e.cssW*e.cssH),a=z*V,m=Math.max(1,Math.sqrt(a/l)),c=e.cssW>=1024||e.cssH>=1024?2:3,M=(u=>Math.max(1,Math.round(u/.25)*.25))(Math.min(i,m,c)),p=z/e.cssW,h=V/e.cssH;let d="dpr",y=M;p<y&&(y=p,d="w"),h<y&&(y=h,d="h"),e.scale=Math.max(1/8,y);let x=0,S=0;d==="h"?(S=Math.max(1,Math.floor(e.cssH*e.scale)),x=Math.max(1,Math.round(S*(e.cssW/e.cssH)))):d==="w"?(x=Math.max(1,Math.floor(e.cssW*e.scale)),S=Math.max(1,Math.round(x*(e.cssH/e.cssW)))):(x=Math.max(1,Math.round(e.cssW*e.scale)),S=Math.max(1,Math.round(e.cssH*e.scale))),!(!e.canvas||!e.ctx)&&(e.canvas.width!==x&&(e.canvas.width=x),e.canvas.height!==S&&(e.canvas.height=S),e.player.x=e.cssW*.14)}function ce(e,t){if(!e.ctx)return;e.prevPlayerY=e.player.y,e.elapsedSec+=t,e.noHitSec+=t,e.recentHitCooldownSec>0&&(e.recentHitCooldownSec=Math.max(0,e.recentHitCooldownSec-t)),e.restCooldownSec>0&&(e.restCooldownSec=Math.max(0,e.restCooldownSec-t));function f(i){const l=Math.max(0,Math.min(1,i));return l<.5?2*l*l:1-Math.pow(-2*l+2,2)/2}function k(){const i=b.scaling,l=Math.max(0,Math.min(1,e.elapsedSec/i.targetSec)),a=1-(1-i.minMultiplier)*f(l),m=1-i.coinFactor*Math.max(0,Math.min(1,e.coinCount/i.coinFullScale)),c=1-i.streakFactor*Math.max(0,Math.min(1,e.noHitSec/i.streakFullSec));let s=a*m*c;return s=Math.max(i.minMultiplier,Math.min(1,s)),(e.lifeCount<=i.relax.whenLifeLE||e.recentHitCooldownSec>0)&&(s*=i.relax.relaxMultiplier),Math.max(.4,Math.min(1.3,s))}if(!e.player.isJumping&&e.pendingJump){e.player.isJumping=!0,e.player.vy=-D,e.pendingJump=!1;try{postMessage({type:"sfx",s:"jump"})}catch{}e.playerRunStartIndexAtJump=e.playerAnimFrameIndex,e.playerRunPhaseMsDuringJump=0,e.playerJumpElapsedMs=0}if(e.player.isJumping&&(e.player.vy+=X*t,e.player.y+=e.player.vy*t,e.playerRunPhaseMsDuringJump+=t*1e3,e.playerJumpElapsedMs=Math.min(e.playerJumpTotalMs,e.playerJumpElapsedMs+t*1e3),e.player.y>=H-e.player.height&&(e.player.y=H-e.player.height,e.player.vy=0,e.player.isJumping=!1,e.playerJumpElapsedMs=e.playerJumpTotalMs,e.playerRunFrames.length>0&&(e.playerAnimFrameIndex=0,e.playerAnimElapsedMs=0),e.playerRunPhaseMsDuringJump=0)),e.playerSprite&&e.playerAtlas){if(e.playerRewardPlaying&&e.playerRewardFrames.length>0)for(e.playerRewardElapsedMs+=t*1e3;e.playerRewardElapsedMs>=e.playerAnimFrameMs;)if(e.playerRewardElapsedMs-=e.playerAnimFrameMs,e.playerRewardFrameIndex+1<e.playerRewardFrames.length)e.playerRewardFrameIndex+=1;else{e.playerRewardPlaying=!1,e.playerRewardFrameIndex=e.playerRewardFrames.length-1;break}else if(e.playerHitPlaying&&e.playerHitFrames.length>0)for(e.playerHitElapsedMs+=t*1e3;e.playerHitElapsedMs>=e.playerAnimFrameMs;)if(e.playerHitElapsedMs-=e.playerAnimFrameMs,e.playerHitFrameIndex+1<e.playerHitFrames.length)e.playerHitFrameIndex+=1;else{e.playerHitPlaying=!1,e.playerHitFrameIndex=e.playerHitFrames.length-1;break}else if(e.playerRunFrames.length>0)if(e.player.isJumping)e.playerAnimFrameIndex=0,e.playerAnimElapsedMs=0;else for(e.playerAnimElapsedMs+=t*1e3;e.playerAnimElapsedMs>=e.playerAnimFrameMs;)e.playerAnimElapsedMs-=e.playerAnimFrameMs,e.playerAnimFrameIndex=(e.playerAnimFrameIndex+1)%e.playerRunFrames.length}if(e.coinFrames.length>0)for(e.coinAnimElapsedMs+=t*1e3;e.coinAnimElapsedMs>=e.playerAnimFrameMs;)e.coinAnimElapsedMs-=e.playerAnimFrameMs,e.coinAnimFrameIndex=(e.coinAnimFrameIndex+1)%e.coinFrames.length;if(e.heartFrames.length>0)for(e.heartAnimElapsedMs+=t*1e3;e.heartAnimElapsedMs>=e.playerAnimFrameMs;)e.heartAnimElapsedMs-=e.playerAnimFrameMs,e.heartAnimFrameIndex=(e.heartAnimFrameIndex+1)%e.heartFrames.length;if(e.skeletonFrames.length>0)for(e.skeletonAnimElapsedMs+=t*1e3;e.skeletonAnimElapsedMs>=e.playerAnimFrameMs;)e.skeletonAnimElapsedMs-=e.playerAnimFrameMs,e.skeletonAnimFrameIndex=(e.skeletonAnimFrameIndex+1)%e.skeletonFrames.length;if(e.blightFrames&&e.blightFrames.length>0)for(e.blightAnimElapsedMs+=t*1e3;e.blightAnimElapsedMs>=e.playerAnimFrameMs;)e.blightAnimElapsedMs-=e.playerAnimFrameMs,e.blightAnimFrameIndex=(e.blightAnimFrameIndex+1)%e.blightFrames.length;if(e.spawnTimerSec+=t,e.spawnTimerSec>=e.nextSpawnSec){const i=k(),l=Math.random();let a;if(e.sinceLastOnigiriCount<ae?a="negative":e.sinceLastOnigiriCount>=ne?a="collectible":a=l<te?"collectible":"negative",a==="negative"||e.lifeCount>=3){const d=Math.max(0,Math.min(1,e.elapsedSec/b.scaling.targetSec)),y=Math.max(0,Math.min(.95,ie+.35*d)),x=Math.random()<y,S=Math.max(.1,(e.playerJumpTotalMs||0)/1e3),u=Math.max(b.scaling.minSafeGapSec,.6*S),A=Math.max(20,Math.round(G*u));let w=null;for(let r=e.entities.length-1;r>=0;r--){const g=e.entities[r];if(g.kind==="blight"||g.kind==="skeleton"){w=g;break}}const W=Math.max(A,((w==null?void 0:w.width)??0)+12),v=Math.max(e.cssW,w?w.x+W:e.cssW);if(x){const r=_.skeleton;e.entities.push({x:v,y:H-r.hitboxH,width:r.hitboxW,height:r.hitboxH,kind:"skeleton"})}else{const r=_.blight;e.entities.push({x:v,y:H-r.hitboxH,width:r.hitboxW,height:r.hitboxH,kind:"blight"})}if(e.sinceLastOnigiriCount+=1,(()=>{const r=b.scaling,g=Math.max(0,Math.min(1,e.elapsedSec/r.targetSec)),R=g<.5?2*g*g:1-Math.pow(-2*g+2,2)/2,E=1-(1-r.minMultiplier)*R,I=1-r.coinFactor*Math.max(0,Math.min(1,e.coinCount/r.coinFullScale)),n=1-r.streakFactor*Math.max(0,Math.min(1,e.noHitSec/r.streakFullSec));let F=E*I*n;return F=Math.max(r.minMultiplier,Math.min(1,F)),(e.lifeCount<=r.relax.whenLifeLE||e.recentHitCooldownSec>0)&&(F*=r.relax.relaxMultiplier),Math.max(.4,Math.min(1.3,F))})()<=.5&&Math.random()<.25){const r=e.entities[e.entities.length-1],g=Math.max(.1,(e.playerJumpTotalMs||0)/1e3),R=Math.max(b.scaling.minSafeGapSec,.6*g)*1.2,E=Math.max(20,Math.round(G*R)),I=Math.max(E,((r==null?void 0:r.width)??0)+16),n=(r?r.x:e.cssW)+I;let F=Math.random()<y;if(r&&r.kind==="skeleton"&&F&&(F=!1),r&&r.kind==="blight"&&!F&&(F=!0),F){const C=_.skeleton;e.entities.push({x:n,y:H-C.hitboxH,width:C.hitboxW,height:C.hitboxH,kind:"skeleton"})}else{const C=_.blight;e.entities.push({x:n,y:H-C.hitboxH,width:C.hitboxW,height:C.hitboxH,kind:"blight"})}}}else{const d=_.heart;e.entities.push({x:e.cssW,y:H-d.hitboxH,width:d.hitboxW,height:d.hitboxH,kind:"heart"}),e.sinceLastOnigiriCount=0}e.spawnTimerSec=0;const m=b.scaling,c=j*i,s=B*i,M=c+Math.random()*Math.max(0,s-c);let p=Math.max(m.minSafeGapSec,M);const h=m.rest;if(e.restCooldownSec<=0&&i<=h.whenMultiplierLE&&Math.random()<h.probability){const d=Math.max(m.minSafeGapSec,m.minSafeGapSec*h.gapMultiplier);p=Math.max(p,d),e.restCooldownSec=h.cooldownSec}e.nextSpawnSec=p}if(e.coinSpawnTimerSec+=t,e.coinNextSpawnSec<=0&&(e.coinNextSpawnSec=L+Math.random()*(U-L)),e.coinSpawnTimerSec>=e.coinNextSpawnSec){const i=_.coin,l=i.hitboxH,a=D*D/(2*Math.abs(X)),m=Math.max(0,H-a),c=Math.max(0,m-l);e.entities.push({x:e.cssW,y:c,width:i.hitboxW,height:l,kind:"coin"}),e.coinSpawnTimerSec=0,e.coinNextSpawnSec=L+Math.random()*(U-L)}for(let i=e.entities.length-1;i>=0;i--){const l=e.entities[i];if(l.x-=G*t,l.x+l.width<0){e.entities.splice(i,1);continue}if(l.x<e.player.x+e.player.width&&l.x+l.width>e.player.x&&l.y<e.player.y+e.player.height&&l.y+l.height>e.player.y)if(l.kind==="heart"||l.kind==="coin"){if(e.entities.splice(i,1),l.kind==="coin"?(e.coinCount+=1,e.uiDirty=!0):l.kind==="heart"&&e.lifeCount<3&&(e.lifeCount+=1,e.uiDirty=!0),l.kind==="coin")try{postMessage({type:"sfx",s:"coin"})}catch{}else if(l.kind==="heart")try{postMessage({type:"sfx",s:"heart"})}catch{}e.playerRewardFrames.length>0&&(e.playerRewardPlaying=!0,e.playerRewardElapsedMs=0,e.playerRewardFrameIndex=0)}else{if(e.entities.splice(i,1),e.lifeCount>0&&(e.lifeCount-=1,e.uiDirty=!0),e.noHitSec=0,e.recentHitCooldownSec=Math.max(e.recentHitCooldownSec,b.scaling.relax.recentHitSecs),e.lifeCount<=0)try{postMessage({type:"gameover"})}catch{}if(l.kind==="blight")try{postMessage({type:"sfx",s:"blight"})}catch{}else if(l.kind==="skeleton")try{postMessage({type:"sfx",s:"skeleton"})}catch{}e.playerHitFrames.length>0&&(e.playerHitPlaying=!0,e.playerHitElapsedMs=0,e.playerHitFrameIndex=0)}}}async function se(e){var t,f;if(e.ctx&&!(e.playerSprite||e.playerAtlas||e.playerSpriteLoading)&&!(!e.playerSpriteUrl||!e.playerAtlasUrl)){e.playerSpriteLoading=!0;try{const[k,i]=await Promise.all([fetch(e.playerSpriteUrl),fetch(e.playerAtlasUrl)]);if(!k.ok)throw new Error("Failed to fetch player sprite");if(!i.ok)throw new Error("Failed to fetch player atlas");const[l,a]=[await k.blob(),await i.json()],m=await createImageBitmap(l),c=(n,F)=>{var $,ee;const C=(($=n[1].frame)==null?void 0:$.x)??0,Z=((ee=F[1].frame)==null?void 0:ee.x)??0;if(C!==Z)return C-Z;const de=parseInt(n[0].split("_")[1]||"0",10),ye=parseInt(F[0].split("_")[1]||"0",10);return de-ye},s=a.frames||{},M=Object.entries(s).filter(([n])=>n.startsWith("run_")).sort(c),p=Object.entries(s).filter(([n])=>n.startsWith("jump_")).sort(c),h=Object.entries(s).filter(([n])=>n.startsWith("hit_")).sort(c),d=Object.entries(s).filter(([n])=>n.startsWith("blight_")).sort(c),y=Object.entries(s).filter(([n])=>n.startsWith("heart_")).sort(c),x=Object.entries(s).filter(([n])=>n.startsWith("coin_")).sort(c),S=Object.entries(s).filter(([n])=>n.startsWith("skeleton_")).sort(c),u=n=>(n||[]).filter(F=>!!s[F]),A=a.animations||{};let w=u(A.run),W=u(A.jump),v=u(A.hit),N=u(A.reward),r=u(A.blight),g=u(A.heart),R=(t=u(A.coin))==null?void 0:t[0],E=u(A.coin),I=u(A.skeleton);(!w||w.length===0)&&(w=M.map(([n])=>n)),(!W||W.length===0)&&(W=p.map(([n])=>n)),(!v||v.length===0)&&(v=h.map(([n])=>n)),(!N||N.length===0)&&(N=Object.keys(s).filter(n=>n.startsWith("reward_")).sort().map(n=>n)),(!r||r.length===0)&&(r=d.map(([n])=>n)),(!g||g.length===0)&&(g=y.map(([n])=>n)),R||(R=(f=x[0])==null?void 0:f[0]),(!E||E.length===0)&&(E=x.map(([n])=>n)),(!I||I.length===0)&&(I=S.map(([n])=>n)),e.playerRunFrames=w,e.playerJumpFrames=W,e.playerHitFrames=v,e.playerRewardFrames=N,e.blightFrames=r||[],e.heartFrames=g||[],e.coinFrameName=R??null,e.coinFrames=E||[],e.skeletonFrames=I||[],e.playerSprite=m,e.playerAtlas=a}finally{e.playerSpriteLoading=!1}}}function he(e,t=1,f=1/60){if(!e.ctx||!e.canvas)return;e.transparentBg?e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height):(e.ctx.fillStyle=e.skyColor,e.ctx.fillRect(0,0,e.canvas.width,e.canvas.height));const k=e.cssH-re,i=Math.round((k-H)*e.scale),l=e.prevPlayerY+(e.player.y-e.prevPlayerY)*t;if(se(e),e.playerSprite&&e.playerAtlas){let a=null;if(e.playerRewardPlaying&&e.playerRewardFrames.length>0)a=e.playerRewardFrames[Math.max(0,Math.min(e.playerRewardFrames.length-1,e.playerRewardFrameIndex))]||null;else if(e.playerHitPlaying&&e.playerHitFrames.length>0)a=e.playerHitFrames[Math.max(0,Math.min(e.playerHitFrames.length-1,e.playerHitFrameIndex))]||null;else if(e.player.isJumping&&e.playerJumpFrames.length>0){const M=e.playerJumpTotalMs||1,p=Math.max(0,Math.min(1,e.playerJumpElapsedMs/M)),h=.1;if(p<h&&e.playerRunFrames.length>0)a=e.playerRunFrames[Math.max(0,Math.min(e.playerRunFrames.length-1,e.playerRunStartIndexAtJump))];else{const d=Math.max(0,Math.min(1,(p-h)/(1-h))),y=e.playerJumpFrames.length,x=Math.max(0,Math.min(y-1,Math.floor(d*(y-1)+1e-6)));a=e.playerJumpFrames[x]}}else e.playerRunFrames.length>0&&(a=e.playerRunFrames[Math.max(0,Math.min(e.playerRunFrames.length-1,e.playerAnimFrameIndex))]);const m=a?e.playerAtlas.frames[a]:void 0,c=m==null?void 0:m.frame,s=(m==null?void 0:m.pivot)||{x:.5,y:1};if(c){const M=T.visualHeight,p=c.w/c.h*M,h=e.player.x-s.x*p+T.offsetX,y=l+e.player.height+0-M*s.y,x=Math.round(h*e.scale),S=Math.round(y*e.scale+i),u=Math.max(1,Math.round(p*e.scale)),A=Math.max(1,Math.round(M*e.scale)),w=e.ctx.imageSmoothingEnabled;e.ctx.imageSmoothingEnabled=!1,e.ctx.drawImage(e.playerSprite,c.x,c.y,c.w,c.h,x,S,u,A),e.ctx.imageSmoothingEnabled=w}}else e.ctx.fillStyle="#000",e.ctx.fillRect(Math.round(e.player.x*e.scale),Math.round(l*e.scale+i),Math.round(e.player.width*e.scale),Math.round(e.player.height*e.scale));if(e.debugDrawHitboxes){const a=Math.round(e.player.x*e.scale),m=Math.round(l*e.scale+i),c=Math.round(e.player.width*e.scale),s=Math.round(e.player.height*e.scale);e.ctx.save(),e.ctx.globalAlpha=.3,e.ctx.fillStyle="#ff00ff",e.ctx.fillRect(a,m,c,s),e.ctx.globalAlpha=1,e.ctx.lineWidth=Math.max(1,Math.round(e.scale)),e.ctx.strokeStyle="#ff00ff",e.ctx.strokeRect(a,m,c,s),e.ctx.restore()}for(const a of e.entities){const c=a.x+G*f*(1-t),s=a.y;if(e.playerSprite&&e.playerAtlas&&(a.kind==="blight"||a.kind==="skeleton"||a.kind==="heart"||a.kind==="coin")){const M=a.kind==="blight"?e.blightFrames.length>0?e.blightFrames[Math.max(0,Math.min(e.blightFrames.length-1,e.blightAnimFrameIndex))]:null:a.kind==="skeleton"?e.skeletonFrames.length>0?e.skeletonFrames[Math.max(0,Math.min(e.skeletonFrames.length-1,e.skeletonAnimFrameIndex))]:null:a.kind==="heart"?e.heartFrames.length>0?e.heartFrames[Math.max(0,Math.min(e.heartFrames.length-1,e.heartAnimFrameIndex))]:null:e.coinFrames.length>0?e.coinFrames[Math.max(0,Math.min(e.coinFrames.length-1,e.coinAnimFrameIndex))]:e.coinFrameName,p=M?e.playerAtlas.frames[M]:void 0,h=p==null?void 0:p.frame,d=(p==null?void 0:p.pivot)||{x:.5,y:1};if(h){const y=_[a.kind],x=y.visualHeight,S=h.w/h.h*x,u=c-d.x*S+a.width*.5+(y.offsetX||0),w=s+a.height+(y.offsetY||0)-x*d.y,W=Math.round(u*e.scale),v=Math.round(w*e.scale+i),N=Math.max(1,Math.round(S*e.scale)),r=Math.max(1,Math.round(x*e.scale)),g=e.ctx.imageSmoothingEnabled;if(e.ctx.imageSmoothingEnabled=!1,e.ctx.drawImage(e.playerSprite,h.x,h.y,h.w,h.h,W,v,N,r),e.ctx.imageSmoothingEnabled=g,e.debugDrawHitboxes){const R=Math.round(c*e.scale),E=Math.round(s*e.scale+i),I=Math.round(a.width*e.scale),n=Math.round(a.height*e.scale);e.ctx.save(),e.ctx.globalAlpha=.3,e.ctx.fillStyle="#ff00ff",e.ctx.fillRect(R,E,I,n),e.ctx.globalAlpha=1,e.ctx.lineWidth=Math.max(1,Math.round(e.scale)),e.ctx.strokeStyle="#ff00ff",e.ctx.strokeRect(R,E,I,n),e.ctx.restore()}continue}}if(e.ctx.fillStyle=a.kind==="heart"?"#0a0":a.kind==="coin"?"#fc0":"red",e.ctx.fillRect(Math.round(c*e.scale),Math.round(s*e.scale+i),Math.round(a.width*e.scale),Math.round(a.height*e.scale)),e.debugDrawHitboxes){const M=Math.round(c*e.scale),p=Math.round(s*e.scale+i),h=Math.round(a.width*e.scale),d=Math.round(a.height*e.scale);e.ctx.save(),e.ctx.globalAlpha=.3,e.ctx.fillStyle="#ff00ff",e.ctx.fillRect(M,p,h,d),e.ctx.globalAlpha=1,e.ctx.lineWidth=Math.max(1,Math.round(e.scale)),e.ctx.strokeStyle="#ff00ff",e.ctx.strokeRect(M,p,h,d),e.ctx.restore()}}}function Y(){o.ready||(o.ready=!0,postMessage({type:"ready"}))}let P=0,J=0;const O=1e3/60,Q=100,pe=5;function me(e){if(!o.ready)return;P||(P=e);let t=e-P;P=e,t<0&&(t=0),t>Q&&(t=Q),J+=t;let f=0;for(;J>=O&&f<pe;)ce(o,O/1e3),J-=O,f++;o.uiElapsedMs+=t,o.uiDirty&&o.uiElapsedMs>=o.uiIntervalMs&&(postMessage({type:"ui",coinCount:o.coinCount,lifeCount:o.lifeCount}),o.uiDirty=!1,o.uiElapsedMs=0);const k=Math.max(0,Math.min(1,J/O));he(o,k,O/1e3)}onmessage=e=>{const t=e.data||{};switch(t.type){case"init":{o.canvas=t.canvas,o.skyColor=typeof t.skyColor=="string"?t.skyColor:o.skyColor,o.expectResize=!!t.expectResize,o.debugDrawHitboxes=!!t.debugHitboxes;const f=!!t.alpha;if(o.ctx=o.canvas.getContext("2d",{alpha:f}),!o.ctx)return;o.ctx.imageSmoothingEnabled=!1,o.transparentBg=!!t.transparentBg,K(o,t.cssW,t.cssH,t.dpr),o.expectResize?(o.readyTimer&&clearTimeout(o.readyTimer),o.readyTimer=setTimeout(()=>{Y()},200)):Y();break}case"resize":{K(o,t.cssW,t.cssH,t.dpr),o.expectResize&&(o.expectResize=!1,o.readyTimer&&(clearTimeout(o.readyTimer),o.readyTimer=null),Y());break}case"frame":{me(typeof t.now=="number"?t.now:performance.now());break}case"vis":{P=0,J=0;break}case"input":{(t.tap||t.space)&&(o.player.isJumping||(o.pendingJump=!0));break}}}})();
//# sourceMappingURL=worker.entry-Bf-palH9.js.map
