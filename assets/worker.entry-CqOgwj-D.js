(function(){"use strict";const b={obstacles:{intervalMinSec:1,intervalMaxSec:1.9,skeletonInNegativeProb:.35},heart:{baseProb:.01,minGapObs:9,maxGapObs:15},coin:{intervalMinSec:1.5,intervalMaxSec:3},scaling:{targetSec:180,minMultiplier:.4,minSafeGapSec:.7,coinFullScale:100,coinFactor:.25,streakFullSec:30,streakFactor:.125,relax:{whenLifeLE:1,recentHitSecs:5,relaxMultiplier:1.15},rest:{whenMultiplierLE:.7,probability:.4,gapMultiplier:4,cooldownSec:5}}},O=b.obstacles.intervalMinSec,X=b.obstacles.intervalMaxSec,V=b.heart.baseProb,q=b.heart.minGapObs,K=b.heart.maxGapObs,Q=b.obstacles.skeletonInNegativeProb,J=b.coin.intervalMinSec,Y=b.coin.intervalMaxSec,j=3072,L=3072,W={hitboxW:20,hitboxH:60,visualHeight:80,offsetX:5},v={blight:{hitboxW:30,hitboxH:40,visualHeight:80,offsetX:4,offsetY:0},skeleton:{hitboxW:20,hitboxH:60,visualHeight:80,offsetX:-7,offsetY:0},heart:{hitboxW:16,hitboxH:16,visualHeight:80,offsetX:0,offsetY:28},coin:{hitboxW:24,hitboxH:24,visualHeight:80,offsetX:0,offsetY:30}},Z=160,$=new URL("./runner-sprite-sheet-DHgMcSOn.webp",self.location.href),ee=new URL("./runner-sprite-sheet-C2KdOAdB.json",self.location.href),r={ctx:null,canvas:null,cssW:0,cssH:0,scale:1,transparentBg:!1,ready:!1,expectResize:!1,readyTimer:null,coinCount:0,lifeCount:3,uiDirty:!0,uiElapsedMs:0,uiIntervalMs:120,elapsedSec:0,noHitSec:0,recentHitCooldownSec:0,restCooldownSec:0,player:{x:0,y:550-W.hitboxH,width:W.hitboxW,height:W.hitboxH,vy:0,isJumping:!1},entities:[],spawnTimerSec:0,sinceLastHeartCount:0,nextSpawnSec:O+Math.random()*(X-O),pendingJump:!1,coinSpawnTimerSec:0,coinNextSpawnSec:0,skyColor:"#e0f7fa",debugDrawHitboxes:!1,playerSpriteUrl:$.toString(),playerAtlasUrl:ee.toString(),playerSprite:null,playerAtlas:null,playerSpriteLoading:!1,playerRunFrames:[],playerJumpFrames:[],playerHitFrames:[],playerRewardFrames:[],playerDyingFrames:[],blightFrames:[],heartFrames:[],coinFrameName:null,coinFrames:[],blightAnimElapsedMs:0,blightAnimFrameIndex:0,skeletonFrames:[],heartAnimElapsedMs:0,heartAnimFrameIndex:0,coinAnimElapsedMs:0,coinAnimFrameIndex:0,skeletonAnimElapsedMs:0,skeletonAnimFrameIndex:0,playerAnimFps:12,playerAnimFrameMs:1e3/12,playerAnimElapsedMs:0,playerAnimFrameIndex:0,playerRunStartIndexAtJump:0,playerRunPhaseMsDuringJump:0,playerJumpElapsedMs:0,playerJumpTotalMs:2*Math.abs(720)/Math.abs(2160)*1e3,playerHitPlaying:!1,playerHitElapsedMs:0,playerHitFrameIndex:0,playerRewardPlaying:!1,playerRewardElapsedMs:0,playerRewardFrameIndex:0,isDying:!1,dyingElapsedMs:0,dyingDurationMs:2e3,gameOverSent:!1,playerDyingPlaying:!1,playerDyingElapsedMs:0,playerDyingFrameIndex:0,prevPlayerY:550-W.hitboxH};function B(e,a,S,C){e.cssW=Math.max(1,Math.floor(a)),e.cssH=Math.max(1,Math.floor(S));const i=Math.max(C||1,1),l=Math.max(1,e.cssW*e.cssH),t=j*L,c=Math.max(1,Math.sqrt(t/l)),s=e.cssW>=1024||e.cssH>=1024?2:3,M=(u=>Math.max(1,Math.round(u/.25)*.25))(Math.min(i,c,s)),d=j/e.cssW,p=L/e.cssH;let h="dpr",g=M;d<g&&(g=d,h="w"),p<g&&(g=p,h="h"),e.scale=Math.max(1/8,g);let f=0,m=0;h==="h"?(m=Math.max(1,Math.floor(e.cssH*e.scale)),f=Math.max(1,Math.round(m*(e.cssW/e.cssH)))):h==="w"?(f=Math.max(1,Math.floor(e.cssW*e.scale)),m=Math.max(1,Math.round(f*(e.cssH/e.cssW)))):(f=Math.max(1,Math.round(e.cssW*e.scale)),m=Math.max(1,Math.round(e.cssH*e.scale))),!(!e.canvas||!e.ctx)&&(e.canvas.width!==f&&(e.canvas.width=f),e.canvas.height!==m&&(e.canvas.height=m),e.player.x=e.cssW*.14)}function ae(e,a){if(!e.ctx)return;e.prevPlayerY=e.player.y,e.elapsedSec+=a,e.noHitSec+=a,e.recentHitCooldownSec>0&&(e.recentHitCooldownSec=Math.max(0,e.recentHitCooldownSec-a)),e.restCooldownSec>0&&(e.restCooldownSec=Math.max(0,e.restCooldownSec-a));function S(i){const l=Math.max(0,Math.min(1,i));return l<.5?2*l*l:1-Math.pow(-2*l+2,2)/2}function C(){const i=b.scaling,l=Math.max(0,Math.min(1,e.elapsedSec/i.targetSec)),t=1-(1-i.minMultiplier)*S(l),c=1-i.coinFactor*Math.max(0,Math.min(1,e.coinCount/i.coinFullScale)),s=1-i.streakFactor*Math.max(0,Math.min(1,e.noHitSec/i.streakFullSec));let y=t*c*s;return y=Math.max(i.minMultiplier,Math.min(1,y)),(e.lifeCount<=i.relax.whenLifeLE||e.recentHitCooldownSec>0)&&(y*=i.relax.relaxMultiplier),Math.max(.4,Math.min(1.3,y))}if(e.isDying)e.pendingJump=!1,e.player.isJumping=!1,e.player.vy=0,e.player.y=550-e.player.height;else if(!e.player.isJumping&&e.pendingJump){e.player.isJumping=!0,e.player.vy=-720,e.pendingJump=!1;try{postMessage({type:"sfx",s:"jump"})}catch{}e.playerRunStartIndexAtJump=e.playerAnimFrameIndex,e.playerRunPhaseMsDuringJump=0,e.playerJumpElapsedMs=0}if(!e.isDying&&e.player.isJumping&&(e.player.vy+=2160*a,e.player.y+=e.player.vy*a,e.playerRunPhaseMsDuringJump+=a*1e3,e.playerJumpElapsedMs=Math.min(e.playerJumpTotalMs,e.playerJumpElapsedMs+a*1e3),e.player.y>=550-e.player.height&&(e.player.y=550-e.player.height,e.player.vy=0,e.player.isJumping=!1,e.playerJumpElapsedMs=e.playerJumpTotalMs,e.playerRunFrames.length>0&&(e.playerAnimFrameIndex=0,e.playerAnimElapsedMs=0),e.playerRunPhaseMsDuringJump=0)),e.playerSprite&&e.playerAtlas){if(e.isDying&&e.playerDyingFrames&&e.playerDyingFrames.length>0)for(e.playerDyingElapsedMs+=a*1e3;e.playerDyingElapsedMs>=e.playerAnimFrameMs;)if(e.playerDyingElapsedMs-=e.playerAnimFrameMs,e.playerDyingFrameIndex+1<e.playerDyingFrames.length)e.playerDyingFrameIndex+=1;else{e.playerDyingPlaying=!1,e.playerDyingFrameIndex=e.playerDyingFrames.length-1;break}else if(e.playerRewardPlaying&&e.playerRewardFrames.length>0)for(e.playerRewardElapsedMs+=a*1e3;e.playerRewardElapsedMs>=e.playerAnimFrameMs;)if(e.playerRewardElapsedMs-=e.playerAnimFrameMs,e.playerRewardFrameIndex+1<e.playerRewardFrames.length)e.playerRewardFrameIndex+=1;else{e.playerRewardPlaying=!1,e.playerRewardFrameIndex=e.playerRewardFrames.length-1;break}else if(e.playerHitPlaying&&e.playerHitFrames.length>0)for(e.playerHitElapsedMs+=a*1e3;e.playerHitElapsedMs>=e.playerAnimFrameMs;)if(e.playerHitElapsedMs-=e.playerAnimFrameMs,e.playerHitFrameIndex+1<e.playerHitFrames.length)e.playerHitFrameIndex+=1;else{e.playerHitPlaying=!1,e.playerHitFrameIndex=e.playerHitFrames.length-1;break}else if(e.playerRunFrames.length>0)if(e.player.isJumping)e.playerAnimFrameIndex=0,e.playerAnimElapsedMs=0;else for(e.playerAnimElapsedMs+=a*1e3;e.playerAnimElapsedMs>=e.playerAnimFrameMs;)e.playerAnimElapsedMs-=e.playerAnimFrameMs,e.playerAnimFrameIndex=(e.playerAnimFrameIndex+1)%e.playerRunFrames.length}if(!e.isDying&&e.coinFrames.length>0)for(e.coinAnimElapsedMs+=a*1e3;e.coinAnimElapsedMs>=e.playerAnimFrameMs;)e.coinAnimElapsedMs-=e.playerAnimFrameMs,e.coinAnimFrameIndex=(e.coinAnimFrameIndex+1)%e.coinFrames.length;if(!e.isDying&&e.heartFrames.length>0)for(e.heartAnimElapsedMs+=a*1e3;e.heartAnimElapsedMs>=e.playerAnimFrameMs;)e.heartAnimElapsedMs-=e.playerAnimFrameMs,e.heartAnimFrameIndex=(e.heartAnimFrameIndex+1)%e.heartFrames.length;if(!e.isDying&&e.skeletonFrames.length>0)for(e.skeletonAnimElapsedMs+=a*1e3;e.skeletonAnimElapsedMs>=e.playerAnimFrameMs;)e.skeletonAnimElapsedMs-=e.playerAnimFrameMs,e.skeletonAnimFrameIndex=(e.skeletonAnimFrameIndex+1)%e.skeletonFrames.length;if(!e.isDying&&e.blightFrames&&e.blightFrames.length>0)for(e.blightAnimElapsedMs+=a*1e3;e.blightAnimElapsedMs>=e.playerAnimFrameMs;)e.blightAnimElapsedMs-=e.playerAnimFrameMs,e.blightAnimFrameIndex=(e.blightAnimFrameIndex+1)%e.blightFrames.length;if(e.isDying||(e.spawnTimerSec+=a),!e.isDying&&e.spawnTimerSec>=e.nextSpawnSec){const i=C(),l=Math.random();let t;if(e.sinceLastHeartCount<q?t="negative":e.sinceLastHeartCount>=K?t="collectible":t=l<V?"collectible":"negative",t==="negative"||e.lifeCount>=3){const h=Math.max(0,Math.min(1,e.elapsedSec/b.scaling.targetSec)),g=Math.max(0,Math.min(.95,Q+.35*h)),f=Math.random()<g,m=Math.max(.1,(e.playerJumpTotalMs||0)/1e3),u=Math.max(b.scaling.minSafeGapSec,.6*m),R=Math.max(20,Math.round(240*u));let w=null;for(let o=e.entities.length-1;o>=0;o--){const x=e.entities[o];if(x.kind==="blight"||x.kind==="skeleton"){w=x;break}}const D=Math.max(R,(w?.width??0)+12),I=Math.max(e.cssW,w?w.x+D:e.cssW);if(f){const o=v.skeleton;e.entities.push({x:I,y:550-o.hitboxH,width:o.hitboxW,height:o.hitboxH,kind:"skeleton"})}else{const o=v.blight;e.entities.push({x:I,y:550-o.hitboxH,width:o.hitboxW,height:o.hitboxH,kind:"blight"})}if(e.sinceLastHeartCount+=1,(()=>{const o=b.scaling,x=Math.max(0,Math.min(1,e.elapsedSec/o.targetSec)),k=x<.5?2*x*x:1-Math.pow(-2*x+2,2)/2,A=1-(1-o.minMultiplier)*k,H=1-o.coinFactor*Math.max(0,Math.min(1,e.coinCount/o.coinFullScale)),n=1-o.streakFactor*Math.max(0,Math.min(1,e.noHitSec/o.streakFullSec));let F=A*H*n;return F=Math.max(o.minMultiplier,Math.min(1,F)),(e.lifeCount<=o.relax.whenLifeLE||e.recentHitCooldownSec>0)&&(F*=o.relax.relaxMultiplier),Math.max(.4,Math.min(1.3,F))})()<=.5&&Math.random()<.25){const o=e.entities[e.entities.length-1],x=Math.max(.1,(e.playerJumpTotalMs||0)/1e3),k=Math.max(b.scaling.minSafeGapSec,.6*x)*1.2,A=Math.max(20,Math.round(240*k)),H=Math.max(A,(o?.width??0)+16),n=(o?o.x:e.cssW)+H;let F=Math.random()<g;if(o&&o.kind==="skeleton"&&F&&(F=!1),o&&o.kind==="blight"&&!F&&(F=!0),F){const E=v.skeleton;e.entities.push({x:n,y:550-E.hitboxH,width:E.hitboxW,height:E.hitboxH,kind:"skeleton"})}else{const E=v.blight;e.entities.push({x:n,y:550-E.hitboxH,width:E.hitboxW,height:E.hitboxH,kind:"blight"})}}}else{const h=v.heart;e.entities.push({x:e.cssW,y:550-h.hitboxH,width:h.hitboxW,height:h.hitboxH,kind:"heart"}),e.sinceLastHeartCount=0}e.spawnTimerSec=0;const c=b.scaling,s=O*i,y=X*i,M=s+Math.random()*Math.max(0,y-s);let d=Math.max(c.minSafeGapSec,M);const p=c.rest;if(e.restCooldownSec<=0&&i<=p.whenMultiplierLE&&Math.random()<p.probability){const h=Math.max(c.minSafeGapSec,c.minSafeGapSec*p.gapMultiplier);d=Math.max(d,h),e.restCooldownSec=p.cooldownSec}e.nextSpawnSec=d}if(e.isDying||(e.coinSpawnTimerSec+=a),!e.isDying&&e.coinNextSpawnSec<=0&&(e.coinNextSpawnSec=J+Math.random()*(Y-J)),!e.isDying&&e.coinSpawnTimerSec>=e.coinNextSpawnSec){const i=v.coin,l=i.hitboxH,t=720*720/(2*Math.abs(2160)),c=Math.max(0,550-t),s=Math.max(0,c-l);e.entities.push({x:e.cssW,y:s,width:i.hitboxW,height:l,kind:"coin"}),e.coinSpawnTimerSec=0,e.coinNextSpawnSec=J+Math.random()*(Y-J)}if(!e.isDying)for(let i=e.entities.length-1;i>=0;i--){const l=e.entities[i];if(l.x-=240*a,l.x+l.width<0){e.entities.splice(i,1);continue}if(l.x<e.player.x+e.player.width&&l.x+l.width>e.player.x&&l.y<e.player.y+e.player.height&&l.y+l.height>e.player.y){if(e.isDying)continue;if(l.kind==="heart"||l.kind==="coin"){if(e.entities.splice(i,1),l.kind==="coin"?(e.coinCount+=1,e.uiDirty=!0):l.kind==="heart"&&e.lifeCount<3&&(e.lifeCount+=1,e.uiDirty=!0),l.kind==="coin")try{postMessage({type:"sfx",s:"coin"})}catch{}else if(l.kind==="heart")try{postMessage({type:"sfx",s:"heart"})}catch{}e.playerRewardFrames.length>0&&(e.playerRewardPlaying=!0,e.playerRewardElapsedMs=0,e.playerRewardFrameIndex=0)}else{if(e.entities.splice(i,1),e.lifeCount>0&&(e.lifeCount-=1,e.uiDirty=!0),e.noHitSec=0,e.recentHitCooldownSec=Math.max(e.recentHitCooldownSec,b.scaling.relax.recentHitSecs),l.kind==="blight")try{postMessage({type:"sfx",s:"blight"})}catch{}else if(l.kind==="skeleton")try{postMessage({type:"sfx",s:"skeleton"})}catch{}if(e.lifeCount<=0&&!e.isDying){e.isDying=!0,e.dyingElapsedMs=0,e.gameOverSent=!1,e.pendingJump=!1,e.player.isJumping=!1,e.player.vy=0,e.player.y=550-e.player.height,e.playerHitPlaying=!1,e.playerRewardPlaying=!1;try{postMessage({type:"death"})}catch{}e.playerDyingFrames.length>0&&(e.playerDyingPlaying=!0,e.playerDyingElapsedMs=0,e.playerDyingFrameIndex=0)}else e.playerHitFrames.length>0&&(e.playerHitPlaying=!0,e.playerHitElapsedMs=0,e.playerHitFrameIndex=0)}}}if(e.isDying&&(e.dyingElapsedMs+=a*1e3,!e.gameOverSent&&e.dyingElapsedMs>=e.dyingDurationMs)){e.gameOverSent=!0;try{postMessage({type:"gameover"})}catch{}}}async function te(e){if(e.ctx&&!(e.playerSprite||e.playerAtlas||e.playerSpriteLoading)&&!(!e.playerSpriteUrl||!e.playerAtlasUrl)){e.playerSpriteLoading=!0;try{const[a,S]=await Promise.all([fetch(e.playerSpriteUrl),fetch(e.playerAtlasUrl)]);if(!a.ok)throw new Error("Failed to fetch player sprite");if(!S.ok)throw new Error("Failed to fetch player atlas");const[C,i]=[await a.blob(),await S.json()],l=await createImageBitmap(C),t=(n,F)=>{const E=n[1].frame?.x??0,U=F[1].frame?.x??0;if(E!==U)return E-U;const le=parseInt(n[0].split("_")[1]||"0",10),oe=parseInt(F[0].split("_")[1]||"0",10);return le-oe},c=i.frames||{},s=Object.entries(c).filter(([n])=>n.startsWith("run_")).sort(t),y=Object.entries(c).filter(([n])=>n.startsWith("jump_")).sort(t),M=Object.entries(c).filter(([n])=>n.startsWith("hit_")).sort(t),d=Object.entries(c).filter(([n])=>n.startsWith("dying_")).sort(t),p=Object.entries(c).filter(([n])=>n.startsWith("blight_")).sort(t),h=Object.entries(c).filter(([n])=>n.startsWith("heart_")).sort(t),g=Object.entries(c).filter(([n])=>n.startsWith("coin_")).sort(t),f=Object.entries(c).filter(([n])=>n.startsWith("skeleton_")).sort(t),m=n=>(n||[]).filter(F=>!!c[F]),u=i.animations||{};let R=m(u.run),w=m(u.jump),D=m(u.hit),I=m(u.reward),_=m(u.dying),o=m(u.blight),x=m(u.heart),k=m(u.coin)?.[0],A=m(u.coin),H=m(u.skeleton);(!R||R.length===0)&&(R=s.map(([n])=>n)),(!w||w.length===0)&&(w=y.map(([n])=>n)),(!D||D.length===0)&&(D=M.map(([n])=>n)),(!I||I.length===0)&&(I=Object.keys(c).filter(n=>n.startsWith("reward_")).sort().map(n=>n)),(!_||_.length===0)&&(_=d.map(([n])=>n)),(!o||o.length===0)&&(o=p.map(([n])=>n)),(!x||x.length===0)&&(x=h.map(([n])=>n)),k||(k=g[0]?.[0]),(!A||A.length===0)&&(A=g.map(([n])=>n)),(!H||H.length===0)&&(H=f.map(([n])=>n)),e.playerRunFrames=R,e.playerJumpFrames=w,e.playerHitFrames=D,e.playerRewardFrames=I,e.playerDyingFrames=_,e.blightFrames=o||[],e.heartFrames=x||[],e.coinFrameName=k??null,e.coinFrames=A||[],e.skeletonFrames=H||[],e.playerSprite=l,e.playerAtlas=i}finally{e.playerSpriteLoading=!1}}}function ne(e,a=1,S=1/60){if(!e.ctx||!e.canvas)return;e.transparentBg?e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height):(e.ctx.fillStyle=e.skyColor,e.ctx.fillRect(0,0,e.canvas.width,e.canvas.height));const C=e.cssH-Z,i=Math.round((C-550)*e.scale),l=e.prevPlayerY+(e.player.y-e.prevPlayerY)*a;if(te(e),e.playerSprite&&e.playerAtlas){let t=null;if(e.isDying&&e.playerDyingFrames&&e.playerDyingFrames.length>0)t=e.playerDyingFrames[Math.max(0,Math.min(e.playerDyingFrames.length-1,e.playerDyingFrameIndex))]||null;else if(e.playerRewardPlaying&&e.playerRewardFrames.length>0)t=e.playerRewardFrames[Math.max(0,Math.min(e.playerRewardFrames.length-1,e.playerRewardFrameIndex))]||null;else if(e.playerHitPlaying&&e.playerHitFrames.length>0)t=e.playerHitFrames[Math.max(0,Math.min(e.playerHitFrames.length-1,e.playerHitFrameIndex))]||null;else if(e.player.isJumping&&e.playerJumpFrames.length>0){const M=e.playerJumpTotalMs||1,d=Math.max(0,Math.min(1,e.playerJumpElapsedMs/M)),p=.1;if(d<p&&e.playerRunFrames.length>0)t=e.playerRunFrames[Math.max(0,Math.min(e.playerRunFrames.length-1,e.playerRunStartIndexAtJump))];else{const h=Math.max(0,Math.min(1,(d-p)/(1-p))),g=e.playerJumpFrames.length,f=Math.max(0,Math.min(g-1,Math.floor(h*(g-1)+1e-6)));t=e.playerJumpFrames[f]}}else e.playerRunFrames.length>0&&(t=e.playerRunFrames[Math.max(0,Math.min(e.playerRunFrames.length-1,e.playerAnimFrameIndex))]);const c=t?e.playerAtlas.frames[t]:void 0,s=c?.frame,y=c?.pivot||{x:.5,y:1};if(s){const M=W.visualHeight,d=s.w/s.h*M,p=e.player.x-y.x*d+W.offsetX,g=l+e.player.height+0-M*y.y,f=Math.round(p*e.scale),m=Math.round(g*e.scale+i),u=Math.max(1,Math.round(d*e.scale)),R=Math.max(1,Math.round(M*e.scale)),w=e.ctx.imageSmoothingEnabled;e.ctx.imageSmoothingEnabled=!1,e.ctx.drawImage(e.playerSprite,s.x,s.y,s.w,s.h,f,m,u,R),e.ctx.imageSmoothingEnabled=w}}else e.ctx.fillStyle="#000",e.ctx.fillRect(Math.round(e.player.x*e.scale),Math.round(l*e.scale+i),Math.round(e.player.width*e.scale),Math.round(e.player.height*e.scale));if(e.debugDrawHitboxes){const t=Math.round(e.player.x*e.scale),c=Math.round(l*e.scale+i),s=Math.round(e.player.width*e.scale),y=Math.round(e.player.height*e.scale);e.ctx.save(),e.ctx.globalAlpha=.3,e.ctx.fillStyle="#ff00ff",e.ctx.fillRect(t,c,s,y),e.ctx.globalAlpha=1,e.ctx.lineWidth=Math.max(1,Math.round(e.scale)),e.ctx.strokeStyle="#ff00ff",e.ctx.strokeRect(t,c,s,y),e.ctx.restore()}if(!e.isDying)for(const t of e.entities){const s=t.x+240*S*(1-a),y=t.y;if(e.playerSprite&&e.playerAtlas&&(t.kind==="blight"||t.kind==="skeleton"||t.kind==="heart"||t.kind==="coin")){const M=t.kind==="blight"?e.blightFrames.length>0?e.blightFrames[Math.max(0,Math.min(e.blightFrames.length-1,e.blightAnimFrameIndex))]:null:t.kind==="skeleton"?e.skeletonFrames.length>0?e.skeletonFrames[Math.max(0,Math.min(e.skeletonFrames.length-1,e.skeletonAnimFrameIndex))]:null:t.kind==="heart"?e.heartFrames.length>0?e.heartFrames[Math.max(0,Math.min(e.heartFrames.length-1,e.heartAnimFrameIndex))]:null:e.coinFrames.length>0?e.coinFrames[Math.max(0,Math.min(e.coinFrames.length-1,e.coinAnimFrameIndex))]:e.coinFrameName,d=M?e.playerAtlas.frames[M]:void 0,p=d?.frame,h=d?.pivot||{x:.5,y:1};if(p){const g=v[t.kind],f=g.visualHeight,m=p.w/p.h*f,u=s-h.x*m+t.width*.5+(g.offsetX||0),w=y+t.height+(g.offsetY||0)-f*h.y,D=Math.round(u*e.scale),I=Math.round(w*e.scale+i),_=Math.max(1,Math.round(m*e.scale)),o=Math.max(1,Math.round(f*e.scale)),x=e.ctx.imageSmoothingEnabled;if(e.ctx.imageSmoothingEnabled=!1,e.ctx.drawImage(e.playerSprite,p.x,p.y,p.w,p.h,D,I,_,o),e.ctx.imageSmoothingEnabled=x,e.debugDrawHitboxes){const k=Math.round(s*e.scale),A=Math.round(y*e.scale+i),H=Math.round(t.width*e.scale),n=Math.round(t.height*e.scale);e.ctx.save(),e.ctx.globalAlpha=.3,e.ctx.fillStyle="#ff00ff",e.ctx.fillRect(k,A,H,n),e.ctx.globalAlpha=1,e.ctx.lineWidth=Math.max(1,Math.round(e.scale)),e.ctx.strokeStyle="#ff00ff",e.ctx.strokeRect(k,A,H,n),e.ctx.restore()}continue}}if(e.ctx.fillStyle=t.kind==="heart"?"#0a0":t.kind==="coin"?"#fc0":"red",e.ctx.fillRect(Math.round(s*e.scale),Math.round(y*e.scale+i),Math.round(t.width*e.scale),Math.round(t.height*e.scale)),e.debugDrawHitboxes){const M=Math.round(s*e.scale),d=Math.round(y*e.scale+i),p=Math.round(t.width*e.scale),h=Math.round(t.height*e.scale);e.ctx.save(),e.ctx.globalAlpha=.3,e.ctx.fillStyle="#ff00ff",e.ctx.fillRect(M,d,p,h),e.ctx.globalAlpha=1,e.ctx.lineWidth=Math.max(1,Math.round(e.scale)),e.ctx.strokeStyle="#ff00ff",e.ctx.strokeRect(M,d,p,h),e.ctx.restore()}}}function G(){r.ready||(r.ready=!0,postMessage({type:"ready"}))}let N=0,T=0;const P=1e3/60,z=100,ie=5;function re(e){if(!r.ready)return;N||(N=e);let a=e-N;N=e,a<0&&(a=0),a>z&&(a=z),T+=a;let S=0;for(;T>=P&&S<ie;)ae(r,P/1e3),T-=P,S++;r.uiElapsedMs+=a,r.uiDirty&&r.uiElapsedMs>=r.uiIntervalMs&&(postMessage({type:"ui",coinCount:r.coinCount,lifeCount:r.lifeCount}),r.uiDirty=!1,r.uiElapsedMs=0);const C=Math.max(0,Math.min(1,T/P));ne(r,C,P/1e3)}onmessage=e=>{const a=e.data||{};switch(a.type){case"init":{r.canvas=a.canvas,r.skyColor=typeof a.skyColor=="string"?a.skyColor:r.skyColor,r.expectResize=!!a.expectResize,r.debugDrawHitboxes=!!a.debugHitboxes;const S=!!a.alpha;if(r.ctx=r.canvas.getContext("2d",{alpha:S}),!r.ctx)return;r.ctx.imageSmoothingEnabled=!1,r.transparentBg=!!a.transparentBg,B(r,a.cssW,a.cssH,a.dpr),r.expectResize?(r.readyTimer&&clearTimeout(r.readyTimer),r.readyTimer=setTimeout(()=>{G()},200)):G();break}case"resize":{B(r,a.cssW,a.cssH,a.dpr),r.expectResize&&(r.expectResize=!1,r.readyTimer&&(clearTimeout(r.readyTimer),r.readyTimer=null),G());break}case"frame":{re(typeof a.now=="number"?a.now:performance.now());break}case"vis":{N=0,T=0;break}case"input":{(a.tap||a.space)&&!r.isDying&&r.lifeCount>0&&!r.player.isJumping&&(r.pendingJump=!0);break}}}})();
//# sourceMappingURL=worker.entry-CqOgwj-D.js.map
