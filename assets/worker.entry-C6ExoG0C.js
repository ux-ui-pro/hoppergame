(function(){"use strict";const M={obstacles:{intervalMinSec:1,intervalMaxSec:1.9,skeletonInNegativeProb:.35},heart:{baseProb:.01,minGapObs:9,maxGapObs:15},coin:{intervalMinSec:1.5,intervalMaxSec:3},scaling:{targetSec:180,minMultiplier:.4,minSafeGapSec:.7,coinFullScale:100,coinFactor:.25,streakFullSec:30,streakFactor:.125,relax:{whenLifeLE:1,recentHitSecs:5,relaxMultiplier:1.15},rest:{whenMultiplierLE:.7,probability:.4,gapMultiplier:4,cooldownSec:5}}},k=600-50,G=240,X=720/(1/3),D=720,j=M.obstacles.intervalMinSec,U=M.obstacles.intervalMaxSec,$=M.heart.baseProb,ee=M.heart.minGapObs,te=M.heart.maxGapObs,ae=M.obstacles.skeletonInNegativeProb,L=M.coin.intervalMinSec,B=M.coin.intervalMaxSec,ne=3072,ie=3072,T={hitboxW:20,hitboxH:60,visualHeight:80,offsetX:5},W={blight:{hitboxW:30,hitboxH:40,visualHeight:80,offsetX:4,offsetY:0},skeleton:{hitboxW:20,hitboxH:60,visualHeight:80,offsetX:-7,offsetY:0},heart:{hitboxW:16,hitboxH:16,visualHeight:80,offsetX:0,offsetY:28},coin:{hitboxW:24,hitboxH:24,visualHeight:80,offsetX:0,offsetY:30}},re=160;function z(e,t){let y=e;if(!y.startsWith("data:")){const w=new URL(y);w.searchParams.set("v",t),y=w.toString()}return y}const le=new URL("./runner-sprite-sheet-DtfMcDYK.webp",self.location.href),oe=new URL("./runner-sprite-sheet-BYwRWmd0.json",self.location.href),o={ctx:null,canvas:null,cssW:0,cssH:0,scale:1,transparentBg:!1,ready:!1,expectResize:!1,readyTimer:null,score:0,coinCount:0,lifeCount:3,uiDirty:!0,uiElapsedMs:0,uiIntervalMs:120,elapsedSec:0,noHitSec:0,recentHitCooldownSec:0,restCooldownSec:0,player:{x:0,y:k-T.hitboxH,width:T.hitboxW,height:T.hitboxH,vy:0,isJumping:!1},entities:[],spawnTimerSec:0,sinceLastOnigiriCount:0,nextSpawnSec:j+Math.random()*(U-j),pendingJump:!1,coinSpawnTimerSec:0,coinNextSpawnSec:0,skyColor:"#e0f7fa",debugDrawHitboxes:!1,playerSpriteUrl:z(le.toString(),"3"),playerAtlasUrl:z(oe.toString(),"3"),playerSprite:null,playerAtlas:null,playerSpriteLoading:!1,playerRunFrames:[],playerJumpFrames:[],playerHitFrames:[],playerRewardFrames:[],blightFrames:[],heartFrames:[],coinFrameName:null,coinFrames:[],blightAnimElapsedMs:0,blightAnimFrameIndex:0,skeletonFrames:[],heartAnimElapsedMs:0,heartAnimFrameIndex:0,coinAnimElapsedMs:0,coinAnimFrameIndex:0,skeletonAnimElapsedMs:0,skeletonAnimFrameIndex:0,playerAnimFps:12,playerAnimFrameMs:1e3/12,playerAnimElapsedMs:0,playerAnimFrameIndex:0,playerRunStartIndexAtJump:0,playerRunPhaseMsDuringJump:0,playerJumpElapsedMs:0,playerJumpTotalMs:2*Math.abs(D)/Math.abs(X)*1e3,playerHitPlaying:!1,playerHitElapsedMs:0,playerHitFrameIndex:0,playerRewardPlaying:!1,playerRewardElapsedMs:0,playerRewardFrameIndex:0,prevPlayerY:k-T.hitboxH};function V(e,t,y,w){e.cssW=Math.max(1,Math.floor(t)),e.cssH=Math.max(1,Math.floor(y));const i=Math.min(Math.max(w||1,1),3),r=ne/e.cssW,a=ie/e.cssH;let h="dpr",c=i;r<c&&(c=r,h="w"),a<c&&(c=a,h="h"),e.scale=Math.max(1/8,c);let s=0,m=0;h==="h"?(m=Math.max(1,Math.floor(e.cssH*e.scale)),s=Math.max(1,Math.round(m*(e.cssW/e.cssH)))):h==="w"?(s=Math.max(1,Math.floor(e.cssW*e.scale)),m=Math.max(1,Math.round(s*(e.cssH/e.cssW)))):(s=Math.max(1,Math.round(e.cssW*e.scale)),m=Math.max(1,Math.round(e.cssH*e.scale))),!(!e.canvas||!e.ctx)&&(e.canvas.width!==s&&(e.canvas.width=s),e.canvas.height!==m&&(e.canvas.height=m),e.player.x=e.cssW*.14)}function ce(e,t){if(!e.ctx)return;e.prevPlayerY=e.player.y,e.elapsedSec+=t,e.noHitSec+=t,e.recentHitCooldownSec>0&&(e.recentHitCooldownSec=Math.max(0,e.recentHitCooldownSec-t)),e.restCooldownSec>0&&(e.restCooldownSec=Math.max(0,e.restCooldownSec-t));function y(i){const r=Math.max(0,Math.min(1,i));return r<.5?2*r*r:1-Math.pow(-2*r+2,2)/2}function w(){const i=M.scaling,r=Math.max(0,Math.min(1,e.elapsedSec/i.targetSec)),a=1-(1-i.minMultiplier)*y(r),h=1-i.coinFactor*Math.max(0,Math.min(1,e.coinCount/i.coinFullScale)),c=1-i.streakFactor*Math.max(0,Math.min(1,e.noHitSec/i.streakFullSec));let s=a*h*c;return s=Math.max(i.minMultiplier,Math.min(1,s)),(e.lifeCount<=i.relax.whenLifeLE||e.recentHitCooldownSec>0)&&(s*=i.relax.relaxMultiplier),Math.max(.4,Math.min(1.3,s))}if(!e.player.isJumping&&e.pendingJump){e.player.isJumping=!0,e.player.vy=-D,e.pendingJump=!1;try{postMessage({type:"sfx",s:"jump"})}catch{}e.playerRunStartIndexAtJump=e.playerAnimFrameIndex,e.playerRunPhaseMsDuringJump=0,e.playerJumpElapsedMs=0}if(e.player.isJumping&&(e.player.vy+=X*t,e.player.y+=e.player.vy*t,e.playerRunPhaseMsDuringJump+=t*1e3,e.playerJumpElapsedMs=Math.min(e.playerJumpTotalMs,e.playerJumpElapsedMs+t*1e3),e.player.y>=k-e.player.height&&(e.player.y=k-e.player.height,e.player.vy=0,e.player.isJumping=!1,e.playerJumpElapsedMs=e.playerJumpTotalMs,e.playerRunFrames.length>0&&(e.playerAnimFrameIndex=0,e.playerAnimElapsedMs=0),e.playerRunPhaseMsDuringJump=0)),e.playerSprite&&e.playerAtlas){if(e.playerRewardPlaying&&e.playerRewardFrames.length>0)for(e.playerRewardElapsedMs+=t*1e3;e.playerRewardElapsedMs>=e.playerAnimFrameMs;)if(e.playerRewardElapsedMs-=e.playerAnimFrameMs,e.playerRewardFrameIndex+1<e.playerRewardFrames.length)e.playerRewardFrameIndex+=1;else{e.playerRewardPlaying=!1,e.playerRewardFrameIndex=e.playerRewardFrames.length-1;break}else if(e.playerHitPlaying&&e.playerHitFrames.length>0)for(e.playerHitElapsedMs+=t*1e3;e.playerHitElapsedMs>=e.playerAnimFrameMs;)if(e.playerHitElapsedMs-=e.playerAnimFrameMs,e.playerHitFrameIndex+1<e.playerHitFrames.length)e.playerHitFrameIndex+=1;else{e.playerHitPlaying=!1,e.playerHitFrameIndex=e.playerHitFrames.length-1;break}else if(e.playerRunFrames.length>0)if(e.player.isJumping)e.playerAnimFrameIndex=0,e.playerAnimElapsedMs=0;else for(e.playerAnimElapsedMs+=t*1e3;e.playerAnimElapsedMs>=e.playerAnimFrameMs;)e.playerAnimElapsedMs-=e.playerAnimFrameMs,e.playerAnimFrameIndex=(e.playerAnimFrameIndex+1)%e.playerRunFrames.length}if(e.coinFrames.length>0)for(e.coinAnimElapsedMs+=t*1e3;e.coinAnimElapsedMs>=e.playerAnimFrameMs;)e.coinAnimElapsedMs-=e.playerAnimFrameMs,e.coinAnimFrameIndex=(e.coinAnimFrameIndex+1)%e.coinFrames.length;if(e.heartFrames.length>0)for(e.heartAnimElapsedMs+=t*1e3;e.heartAnimElapsedMs>=e.playerAnimFrameMs;)e.heartAnimElapsedMs-=e.playerAnimFrameMs,e.heartAnimFrameIndex=(e.heartAnimFrameIndex+1)%e.heartFrames.length;if(e.skeletonFrames.length>0)for(e.skeletonAnimElapsedMs+=t*1e3;e.skeletonAnimElapsedMs>=e.playerAnimFrameMs;)e.skeletonAnimElapsedMs-=e.playerAnimFrameMs,e.skeletonAnimFrameIndex=(e.skeletonAnimFrameIndex+1)%e.skeletonFrames.length;if(e.blightFrames&&e.blightFrames.length>0)for(e.blightAnimElapsedMs+=t*1e3;e.blightAnimElapsedMs>=e.playerAnimFrameMs;)e.blightAnimElapsedMs-=e.playerAnimFrameMs,e.blightAnimFrameIndex=(e.blightAnimFrameIndex+1)%e.blightFrames.length;if(e.spawnTimerSec+=t,e.spawnTimerSec>=e.nextSpawnSec){const i=w(),r=Math.random();let a;if(e.sinceLastOnigiriCount<ee?a="negative":e.sinceLastOnigiriCount>=te?a="collectible":a=r<$?"collectible":"negative",a==="negative"||e.lifeCount>=3){const f=Math.max(0,Math.min(1,e.elapsedSec/M.scaling.targetSec)),F=Math.max(0,Math.min(.95,ae+.35*f)),A=Math.random()<F,v=Math.max(.1,(e.playerJumpTotalMs||0)/1e3),u=Math.max(M.scaling.minSafeGapSec,.6*v),S=Math.max(20,Math.round(G*u));let g=null;for(let l=e.entities.length-1;l>=0;l--){const x=e.entities[l];if(x.kind==="blight"||x.kind==="skeleton"){g=x;break}}const _=Math.max(S,((g==null?void 0:g.width)??0)+12),C=Math.max(e.cssW,g?g.x+_:e.cssW);if(A){const l=W.skeleton;e.entities.push({x:C,y:k-l.hitboxH,width:l.hitboxW,height:l.hitboxH,kind:"skeleton"})}else{const l=W.blight;e.entities.push({x:C,y:k-l.hitboxH,width:l.hitboxW,height:l.hitboxH,kind:"blight"})}if(e.sinceLastOnigiriCount+=1,(()=>{const l=M.scaling,x=Math.max(0,Math.min(1,e.elapsedSec/l.targetSec)),I=x<.5?2*x*x:1-Math.pow(-2*x+2,2)/2,H=1-(1-l.minMultiplier)*I,E=1-l.coinFactor*Math.max(0,Math.min(1,e.coinCount/l.coinFullScale)),n=1-l.streakFactor*Math.max(0,Math.min(1,e.noHitSec/l.streakFullSec));let b=H*E*n;return b=Math.max(l.minMultiplier,Math.min(1,b)),(e.lifeCount<=l.relax.whenLifeLE||e.recentHitCooldownSec>0)&&(b*=l.relax.relaxMultiplier),Math.max(.4,Math.min(1.3,b))})()<=.5&&Math.random()<.25){const l=e.entities[e.entities.length-1],x=Math.max(.1,(e.playerJumpTotalMs||0)/1e3),I=Math.max(M.scaling.minSafeGapSec,.6*x)*1.2,H=Math.max(20,Math.round(G*I)),E=Math.max(H,((l==null?void 0:l.width)??0)+16),n=(l?l.x:e.cssW)+E;let b=Math.random()<F;if(l&&l.kind==="skeleton"&&b&&(b=!1),l&&l.kind==="blight"&&!b&&(b=!0),b){const R=W.skeleton;e.entities.push({x:n,y:k-R.hitboxH,width:R.hitboxW,height:R.hitboxH,kind:"skeleton"})}else{const R=W.blight;e.entities.push({x:n,y:k-R.hitboxH,width:R.hitboxW,height:R.hitboxH,kind:"blight"})}}}else{const f=W.heart;e.entities.push({x:e.cssW,y:k-f.hitboxH,width:f.hitboxW,height:f.hitboxH,kind:"heart"}),e.sinceLastOnigiriCount=0}e.spawnTimerSec=0;const h=M.scaling,c=j*i,s=U*i,m=c+Math.random()*Math.max(0,s-c);let d=Math.max(h.minSafeGapSec,m);const p=h.rest;if(e.restCooldownSec<=0&&i<=p.whenMultiplierLE&&Math.random()<p.probability){const f=Math.max(h.minSafeGapSec,h.minSafeGapSec*p.gapMultiplier);d=Math.max(d,f),e.restCooldownSec=p.cooldownSec}e.nextSpawnSec=d}if(e.coinSpawnTimerSec+=t,e.coinNextSpawnSec<=0&&(e.coinNextSpawnSec=L+Math.random()*(B-L)),e.coinSpawnTimerSec>=e.coinNextSpawnSec){const i=W.coin,r=i.hitboxH,a=D*D/(2*Math.abs(X)),h=Math.max(0,k-a),c=Math.max(0,h-r);e.entities.push({x:e.cssW,y:c,width:i.hitboxW,height:r,kind:"coin"}),e.coinSpawnTimerSec=0,e.coinNextSpawnSec=L+Math.random()*(B-L)}for(let i=e.entities.length-1;i>=0;i--){const r=e.entities[i];if(r.x-=G*t,r.x+r.width<0){e.entities.splice(i,1);continue}if(r.x<e.player.x+e.player.width&&r.x+r.width>e.player.x&&r.y<e.player.y+e.player.height&&r.y+r.height>e.player.y)if(r.kind==="heart"||r.kind==="coin"){if(e.entities.splice(i,1),r.kind==="coin"?(e.coinCount+=1,e.uiDirty=!0):r.kind==="heart"&&e.lifeCount<3&&(e.lifeCount+=1,e.uiDirty=!0),r.kind==="coin")try{postMessage({type:"sfx",s:"coin"})}catch{}else if(r.kind==="heart")try{postMessage({type:"sfx",s:"heart"})}catch{}e.playerRewardFrames.length>0&&(e.playerRewardPlaying=!0,e.playerRewardElapsedMs=0,e.playerRewardFrameIndex=0)}else{if(e.entities.splice(i,1),e.lifeCount>0&&(e.lifeCount-=1,e.uiDirty=!0),e.noHitSec=0,e.recentHitCooldownSec=Math.max(e.recentHitCooldownSec,M.scaling.relax.recentHitSecs),e.lifeCount<=0)try{postMessage({type:"gameover"})}catch{}if(r.kind==="blight")try{postMessage({type:"sfx",s:"blight"})}catch{}else if(r.kind==="skeleton")try{postMessage({type:"sfx",s:"skeleton"})}catch{}e.playerHitFrames.length>0&&(e.playerHitPlaying=!0,e.playerHitElapsedMs=0,e.playerHitFrameIndex=0)}}}async function se(e){var t,y;if(e.ctx&&!(e.playerSprite||e.playerAtlas||e.playerSpriteLoading)&&!(!e.playerSpriteUrl||!e.playerAtlasUrl)){e.playerSpriteLoading=!0;try{const[w,i]=await Promise.all([fetch(e.playerSpriteUrl),fetch(e.playerAtlasUrl)]);if(!w.ok)throw new Error("Failed to fetch player sprite");if(!i.ok)throw new Error("Failed to fetch player atlas");const[r,a]=[await w.blob(),await i.json()],h=await createImageBitmap(r),c=(n,b)=>{var q,Z;const R=((q=n[1].frame)==null?void 0:q.x)??0,Q=((Z=b[1].frame)==null?void 0:Z.x)??0;if(R!==Q)return R-Q;const de=parseInt(n[0].split("_")[1]||"0",10),ye=parseInt(b[0].split("_")[1]||"0",10);return de-ye},s=a.frames||{},m=Object.entries(s).filter(([n])=>n.startsWith("run_")).sort(c),d=Object.entries(s).filter(([n])=>n.startsWith("jump_")).sort(c),p=Object.entries(s).filter(([n])=>n.startsWith("hit_")).sort(c),f=Object.entries(s).filter(([n])=>n.startsWith("blight_")).sort(c),F=Object.entries(s).filter(([n])=>n.startsWith("heart_")).sort(c),A=Object.entries(s).filter(([n])=>n.startsWith("coin_")).sort(c),v=Object.entries(s).filter(([n])=>n.startsWith("skeleton_")).sort(c),u=n=>(n||[]).filter(b=>!!s[b]),S=a.animations||{};let g=u(S.run),_=u(S.jump),C=u(S.hit),N=u(S.reward),l=u(S.blight),x=u(S.heart),I=(t=u(S.coin))==null?void 0:t[0],H=u(S.coin),E=u(S.skeleton);(!g||g.length===0)&&(g=m.map(([n])=>n)),(!_||_.length===0)&&(_=d.map(([n])=>n)),(!C||C.length===0)&&(C=p.map(([n])=>n)),(!N||N.length===0)&&(N=Object.keys(s).filter(n=>n.startsWith("reward_")).sort().map(n=>n)),(!l||l.length===0)&&(l=f.map(([n])=>n)),(!x||x.length===0)&&(x=F.map(([n])=>n)),I||(I=(y=A[0])==null?void 0:y[0]),(!H||H.length===0)&&(H=A.map(([n])=>n)),(!E||E.length===0)&&(E=v.map(([n])=>n)),e.playerRunFrames=g,e.playerJumpFrames=_,e.playerHitFrames=C,e.playerRewardFrames=N,e.blightFrames=l||[],e.heartFrames=x||[],e.coinFrameName=I??null,e.coinFrames=H||[],e.skeletonFrames=E||[],e.playerSprite=h,e.playerAtlas=a}finally{e.playerSpriteLoading=!1}}}function he(e,t=1,y=1/60){if(!e.ctx||!e.canvas)return;e.transparentBg?e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height):(e.ctx.fillStyle=e.skyColor,e.ctx.fillRect(0,0,e.canvas.width,e.canvas.height));const w=e.cssH-re,i=Math.round((w-k)*e.scale),r=e.prevPlayerY+(e.player.y-e.prevPlayerY)*t;if(se(e),e.playerSprite&&e.playerAtlas){let a=null;if(e.playerRewardPlaying&&e.playerRewardFrames.length>0)a=e.playerRewardFrames[Math.max(0,Math.min(e.playerRewardFrames.length-1,e.playerRewardFrameIndex))]||null;else if(e.playerHitPlaying&&e.playerHitFrames.length>0)a=e.playerHitFrames[Math.max(0,Math.min(e.playerHitFrames.length-1,e.playerHitFrameIndex))]||null;else if(e.player.isJumping&&e.playerJumpFrames.length>0){const m=e.playerJumpTotalMs||1,d=Math.max(0,Math.min(1,e.playerJumpElapsedMs/m)),p=.1;if(d<p&&e.playerRunFrames.length>0)a=e.playerRunFrames[Math.max(0,Math.min(e.playerRunFrames.length-1,e.playerRunStartIndexAtJump))];else{const f=Math.max(0,Math.min(1,(d-p)/(1-p))),F=e.playerJumpFrames.length,A=Math.max(0,Math.min(F-1,Math.floor(f*(F-1)+1e-6)));a=e.playerJumpFrames[A]}}else e.playerRunFrames.length>0&&(a=e.playerRunFrames[Math.max(0,Math.min(e.playerRunFrames.length-1,e.playerAnimFrameIndex))]);const h=a?e.playerAtlas.frames[a]:void 0,c=h==null?void 0:h.frame,s=(h==null?void 0:h.pivot)||{x:.5,y:1};if(c){const m=T.visualHeight,d=c.w/c.h*m,p=e.player.x-s.x*d+T.offsetX,F=r+e.player.height+0-m*s.y,A=Math.round(p*e.scale),v=Math.round(F*e.scale+i),u=Math.max(1,Math.round(d*e.scale)),S=Math.max(1,Math.round(m*e.scale)),g=e.ctx.imageSmoothingEnabled;e.ctx.imageSmoothingEnabled=!1,e.ctx.drawImage(e.playerSprite,c.x,c.y,c.w,c.h,A,v,u,S),e.ctx.imageSmoothingEnabled=g}}else e.ctx.fillStyle="#000",e.ctx.fillRect(Math.round(e.player.x*e.scale),Math.round(r*e.scale+i),Math.round(e.player.width*e.scale),Math.round(e.player.height*e.scale));if(e.debugDrawHitboxes){const a=Math.round(e.player.x*e.scale),h=Math.round(r*e.scale+i),c=Math.round(e.player.width*e.scale),s=Math.round(e.player.height*e.scale);e.ctx.save(),e.ctx.globalAlpha=.3,e.ctx.fillStyle="#ff00ff",e.ctx.fillRect(a,h,c,s),e.ctx.globalAlpha=1,e.ctx.lineWidth=Math.max(1,Math.round(e.scale)),e.ctx.strokeStyle="#ff00ff",e.ctx.strokeRect(a,h,c,s),e.ctx.restore()}for(const a of e.entities){const c=a.x+G*y*(1-t),s=a.y;if(e.playerSprite&&e.playerAtlas&&(a.kind==="blight"||a.kind==="skeleton"||a.kind==="heart"||a.kind==="coin")){const m=a.kind==="blight"?e.blightFrames.length>0?e.blightFrames[Math.max(0,Math.min(e.blightFrames.length-1,e.blightAnimFrameIndex))]:null:a.kind==="skeleton"?e.skeletonFrames.length>0?e.skeletonFrames[Math.max(0,Math.min(e.skeletonFrames.length-1,e.skeletonAnimFrameIndex))]:null:a.kind==="heart"?e.heartFrames.length>0?e.heartFrames[Math.max(0,Math.min(e.heartFrames.length-1,e.heartAnimFrameIndex))]:null:e.coinFrames.length>0?e.coinFrames[Math.max(0,Math.min(e.coinFrames.length-1,e.coinAnimFrameIndex))]:e.coinFrameName,d=m?e.playerAtlas.frames[m]:void 0,p=d==null?void 0:d.frame,f=(d==null?void 0:d.pivot)||{x:.5,y:1};if(p){const F=W[a.kind],A=F.visualHeight,v=p.w/p.h*A,u=c-f.x*v+a.width*.5+(F.offsetX||0),g=s+a.height+(F.offsetY||0)-A*f.y,_=Math.round(u*e.scale),C=Math.round(g*e.scale+i),N=Math.max(1,Math.round(v*e.scale)),l=Math.max(1,Math.round(A*e.scale)),x=e.ctx.imageSmoothingEnabled;if(e.ctx.imageSmoothingEnabled=!1,e.ctx.drawImage(e.playerSprite,p.x,p.y,p.w,p.h,_,C,N,l),e.ctx.imageSmoothingEnabled=x,e.debugDrawHitboxes){const I=Math.round(c*e.scale),H=Math.round(s*e.scale+i),E=Math.round(a.width*e.scale),n=Math.round(a.height*e.scale);e.ctx.save(),e.ctx.globalAlpha=.3,e.ctx.fillStyle="#ff00ff",e.ctx.fillRect(I,H,E,n),e.ctx.globalAlpha=1,e.ctx.lineWidth=Math.max(1,Math.round(e.scale)),e.ctx.strokeStyle="#ff00ff",e.ctx.strokeRect(I,H,E,n),e.ctx.restore()}continue}}if(e.ctx.fillStyle=a.kind==="heart"?"#0a0":a.kind==="coin"?"#fc0":"red",e.ctx.fillRect(Math.round(c*e.scale),Math.round(s*e.scale+i),Math.round(a.width*e.scale),Math.round(a.height*e.scale)),e.debugDrawHitboxes){const m=Math.round(c*e.scale),d=Math.round(s*e.scale+i),p=Math.round(a.width*e.scale),f=Math.round(a.height*e.scale);e.ctx.save(),e.ctx.globalAlpha=.3,e.ctx.fillStyle="#ff00ff",e.ctx.fillRect(m,d,p,f),e.ctx.globalAlpha=1,e.ctx.lineWidth=Math.max(1,Math.round(e.scale)),e.ctx.strokeStyle="#ff00ff",e.ctx.strokeRect(m,d,p,f),e.ctx.restore()}}}function Y(){o.ready||(o.ready=!0,postMessage({type:"ready"}))}let P=0,J=0;const O=1e3/60,K=100,pe=5;function me(e){if(!o.ready)return;P||(P=e);let t=e-P;P=e,t<0&&(t=0),t>K&&(t=K),J+=t;let y=0;for(;J>=O&&y<pe;)ce(o,O/1e3),J-=O,y++;o.uiElapsedMs+=t,o.uiDirty&&o.uiElapsedMs>=o.uiIntervalMs&&(postMessage({type:"ui",coinCount:o.coinCount,lifeCount:o.lifeCount}),o.uiDirty=!1,o.uiElapsedMs=0);const w=Math.max(0,Math.min(1,J/O));he(o,w,O/1e3)}onmessage=e=>{const t=e.data||{};switch(t.type){case"init":{o.canvas=t.canvas,o.skyColor=typeof t.skyColor=="string"?t.skyColor:o.skyColor,o.expectResize=!!t.expectResize,o.debugDrawHitboxes=!!t.debugHitboxes;const y=!!t.alpha;if(o.ctx=o.canvas.getContext("2d",{alpha:y}),!o.ctx)return;o.ctx.imageSmoothingEnabled=!1,o.transparentBg=!!t.transparentBg,V(o,t.cssW,t.cssH,t.dpr),o.expectResize?(o.readyTimer&&clearTimeout(o.readyTimer),o.readyTimer=setTimeout(()=>{Y()},200)):Y();break}case"resize":{V(o,t.cssW,t.cssH,t.dpr),o.expectResize&&(o.expectResize=!1,o.readyTimer&&(clearTimeout(o.readyTimer),o.readyTimer=null),Y());break}case"frame":{me(typeof t.now=="number"?t.now:performance.now());break}case"vis":{P=0,J=0;break}case"input":{(t.tap||t.space)&&(o.player.isJumping||(o.pendingJump=!0));break}}}})();
//# sourceMappingURL=worker.entry-C6ExoG0C.js.map
