(function(){"use strict";const v={hitboxW:20,hitboxH:60,visualHeight:80,offsetX:5},_={blight:{hitboxW:30,hitboxH:40,visualHeight:80,offsetX:4,offsetY:0},skeleton:{hitboxW:20,hitboxH:60,visualHeight:80,offsetX:-7,offsetY:0},heart:{hitboxW:16,hitboxH:16,visualHeight:80,offsetX:0,offsetY:28},coin:{hitboxW:24,hitboxH:24,visualHeight:80,offsetX:0,offsetY:30}},$=.25,w=600-50,O=240,B=720/(1/3),G=720,A={obstacles:{intervalMinSec:1,intervalMaxSec:1.9,skeletonInNegativeProb:.35},heart:{baseProb:.01,minGapObs:9,maxGapObs:15},coin:{intervalMinSec:1.5,intervalMaxSec:3},scaling:{targetSec:180,minMultiplier:.4,minSafeGapSec:.7,coinFullScale:100,coinFactor:.25,streakFullSec:30,streakFactor:.125,relax:{whenLifeLE:1,recentHitSecs:5,relaxMultiplier:1.15},rest:{whenMultiplierLE:.7,probability:.4,gapMultiplier:4,cooldownSec:5}}},N=A.obstacles.intervalMinSec,j=A.obstacles.intervalMaxSec,ee=A.heart.baseProb,ae=A.heart.minGapObs,te=A.heart.maxGapObs,ne=A.obstacles.skeletonInNegativeProb,L=A.coin.intervalMinSec,z=A.coin.intervalMaxSec,U=3072,V=3072,ie=new URL("./runner-sprite-sheet-DHgMcSOn.webp",self.location.href),re=new URL("./runner-sprite-sheet-C2KdOAdB.json",self.location.href),n={ctx:null,canvas:null,cssW:0,cssH:0,scale:1,transparentBg:!1,ready:!1,expectResize:!1,readyTimer:null,coinCount:0,lifeCount:3,uiDirty:!0,uiElapsedMs:0,uiIntervalMs:120,elapsedSec:0,noHitSec:0,recentHitCooldownSec:0,restCooldownSec:0,player:{x:0,y:w-v.hitboxH,width:v.hitboxW,height:v.hitboxH,vy:0,isJumping:!1},entities:[],spawnTimerSec:0,sinceLastHeartCount:0,nextSpawnSec:N+Math.random()*(j-N),pendingJump:!1,coinSpawnTimerSec:0,coinNextSpawnSec:0,skyColor:"#e0f7fa",debugDrawHitboxes:!1,playerSpriteUrl:ie.toString(),playerAtlasUrl:re.toString(),playerSprite:null,playerAtlas:null,playerSpriteLoading:!1,playerRunFrames:[],playerJumpFrames:[],playerHitFrames:[],playerRewardFrames:[],playerDyingFrames:[],blightFrames:[],heartFrames:[],coinFrameName:null,coinFrames:[],blightAnimElapsedMs:0,blightAnimFrameIndex:0,skeletonFrames:[],heartAnimElapsedMs:0,heartAnimFrameIndex:0,coinAnimElapsedMs:0,coinAnimFrameIndex:0,skeletonAnimElapsedMs:0,skeletonAnimFrameIndex:0,playerAnimFps:12,playerAnimFrameMs:1e3/12,playerAnimElapsedMs:0,playerAnimFrameIndex:0,playerRunStartIndexAtJump:0,playerRunPhaseMsDuringJump:0,playerJumpElapsedMs:0,playerJumpTotalMs:2*Math.abs(G)/Math.abs(B)*1e3,playerHitPlaying:!1,playerHitElapsedMs:0,playerHitFrameIndex:0,playerRewardPlaying:!1,playerRewardElapsedMs:0,playerRewardFrameIndex:0,isDying:!1,dyingElapsedMs:0,dyingDurationMs:2e3,gameOverSent:!1,playerDyingPlaying:!1,playerDyingElapsedMs:0,playerDyingFrameIndex:0,prevPlayerY:w-v.hitboxH};function le(e){e.coinCount=0,e.lifeCount=3,e.uiDirty=!0,e.uiElapsedMs=0,e.elapsedSec=0,e.noHitSec=0,e.recentHitCooldownSec=0,e.restCooldownSec=0,e.player.x=e.cssW*.14,e.player.y=w-v.hitboxH,e.player.vy=0,e.player.isJumping=!1,e.prevPlayerY=e.player.y,e.entities=[],e.spawnTimerSec=0,e.sinceLastHeartCount=0,e.nextSpawnSec=N+Math.random()*(j-N),e.pendingJump=!1,e.coinSpawnTimerSec=0,e.coinNextSpawnSec=0,e.playerAnimElapsedMs=0,e.playerAnimFrameIndex=0,e.playerRunStartIndexAtJump=0,e.playerRunPhaseMsDuringJump=0,e.playerJumpElapsedMs=0,e.playerHitPlaying=!1,e.playerHitElapsedMs=0,e.playerHitFrameIndex=0,e.playerRewardPlaying=!1,e.playerRewardElapsedMs=0,e.playerRewardFrameIndex=0,e.isDying=!1,e.dyingElapsedMs=0,e.gameOverSent=!1,e.playerDyingPlaying=!1,e.playerDyingElapsedMs=0,e.playerDyingFrameIndex=0,e.blightAnimElapsedMs=0,e.blightAnimFrameIndex=0,e.heartAnimElapsedMs=0,e.heartAnimFrameIndex=0,e.coinAnimElapsedMs=0,e.coinAnimFrameIndex=0,e.skeletonAnimElapsedMs=0,e.skeletonAnimFrameIndex=0}function q(e,a,l,r){e.cssW=Math.max(1,Math.floor(a)),e.cssH=Math.max(1,Math.floor(l));const F=Math.max(r||1,1),y=Math.max(1,e.cssW*e.cssH),c=U*V,i=Math.max(1,Math.sqrt(c/y)),f=e.cssW>=1024||e.cssH>=1024?2:3,g=(h=>Math.max(1,Math.round(h/.25)*.25))(Math.min(F,i,f)),s=U/e.cssW,u=V/e.cssH;let p="dpr",M=g;s<M&&(M=s,p="w"),u<M&&(M=u,p="h"),e.scale=Math.max(1/8,M);let d=0,x=0;p==="h"?(x=Math.max(1,Math.floor(e.cssH*e.scale)),d=Math.max(1,Math.round(x*(e.cssW/e.cssH)))):p==="w"?(d=Math.max(1,Math.floor(e.cssW*e.scale)),x=Math.max(1,Math.round(d*(e.cssH/e.cssW)))):(d=Math.max(1,Math.round(e.cssW*e.scale)),x=Math.max(1,Math.round(e.cssH*e.scale))),!(!e.canvas||!e.ctx)&&(e.canvas.width!==d&&(e.canvas.width=d),e.canvas.height!==x&&(e.canvas.height=x),e.player.x=e.cssW*.14)}function oe(e){const a=Math.max(0,Math.min(1,e));return a<.5?2*a*a:1-Math.pow(-2*a+2,2)/2}function pe(e){const a=A.scaling,l=Math.max(0,Math.min(1,e.elapsedSec/a.targetSec)),r=1-(1-a.minMultiplier)*oe(l),F=1-a.coinFactor*Math.max(0,Math.min(1,e.coinCount/a.coinFullScale)),y=1-a.streakFactor*Math.max(0,Math.min(1,e.noHitSec/a.streakFullSec));let c=r*F*y;return c=Math.max(a.minMultiplier,Math.min(1,c)),(e.lifeCount<=a.relax.whenLifeLE||e.recentHitCooldownSec>0)&&(c*=a.relax.relaxMultiplier),Math.max(.4,Math.min(1.3,c))}function ce(e,a){e.elapsedSec+=a,e.noHitSec+=a,e.recentHitCooldownSec>0&&(e.recentHitCooldownSec=Math.max(0,e.recentHitCooldownSec-a)),e.restCooldownSec>0&&(e.restCooldownSec=Math.max(0,e.restCooldownSec-a))}function se(e,a){if(e.isDying)e.pendingJump=!1,e.player.isJumping=!1,e.player.vy=0,e.player.y=w-e.player.height;else if(!e.player.isJumping&&e.pendingJump){e.player.isJumping=!0,e.player.vy=-G,e.pendingJump=!1;try{postMessage({type:"sfx",s:"jump"})}catch{}e.playerRunStartIndexAtJump=e.playerAnimFrameIndex,e.playerRunPhaseMsDuringJump=0,e.playerJumpElapsedMs=0}!e.isDying&&e.player.isJumping&&(e.player.vy+=B*a,e.player.y+=e.player.vy*a,e.playerRunPhaseMsDuringJump+=a*1e3,e.playerJumpElapsedMs=Math.min(e.playerJumpTotalMs,e.playerJumpElapsedMs+a*1e3),e.player.y>=w-e.player.height&&(e.player.y=w-e.player.height,e.player.vy=0,e.player.isJumping=!1,e.playerJumpElapsedMs=e.playerJumpTotalMs,e.playerRunFrames.length>0&&(e.playerAnimFrameIndex=0,e.playerAnimElapsedMs=0),e.playerRunPhaseMsDuringJump=0))}function me(e,a){if(e.playerSprite&&e.playerAtlas){if(e.isDying&&e.playerDyingFrames&&e.playerDyingFrames.length>0)for(e.playerDyingElapsedMs+=a*1e3;e.playerDyingElapsedMs>=e.playerAnimFrameMs;)if(e.playerDyingElapsedMs-=e.playerAnimFrameMs,e.playerDyingFrameIndex+1<e.playerDyingFrames.length)e.playerDyingFrameIndex+=1;else{e.playerDyingPlaying=!1,e.playerDyingFrameIndex=e.playerDyingFrames.length-1;break}else if(e.playerRewardPlaying&&e.playerRewardFrames.length>0)for(e.playerRewardElapsedMs+=a*1e3;e.playerRewardElapsedMs>=e.playerAnimFrameMs;)if(e.playerRewardElapsedMs-=e.playerAnimFrameMs,e.playerRewardFrameIndex+1<e.playerRewardFrames.length)e.playerRewardFrameIndex+=1;else{e.playerRewardPlaying=!1,e.playerRewardFrameIndex=e.playerRewardFrames.length-1;break}else if(e.playerHitPlaying&&e.playerHitFrames.length>0)for(e.playerHitElapsedMs+=a*1e3;e.playerHitElapsedMs>=e.playerAnimFrameMs;)if(e.playerHitElapsedMs-=e.playerAnimFrameMs,e.playerHitFrameIndex+1<e.playerHitFrames.length)e.playerHitFrameIndex+=1;else{e.playerHitPlaying=!1,e.playerHitFrameIndex=e.playerHitFrames.length-1;break}else if(e.playerRunFrames.length>0)if(e.player.isJumping)e.playerAnimFrameIndex=0,e.playerAnimElapsedMs=0;else for(e.playerAnimElapsedMs+=a*1e3;e.playerAnimElapsedMs>=e.playerAnimFrameMs;)e.playerAnimElapsedMs-=e.playerAnimFrameMs,e.playerAnimFrameIndex=(e.playerAnimFrameIndex+1)%e.playerRunFrames.length}if(!e.isDying&&e.coinFrames.length>0)for(e.coinAnimElapsedMs+=a*1e3;e.coinAnimElapsedMs>=e.playerAnimFrameMs;)e.coinAnimElapsedMs-=e.playerAnimFrameMs,e.coinAnimFrameIndex=(e.coinAnimFrameIndex+1)%e.coinFrames.length;if(!e.isDying&&e.heartFrames.length>0)for(e.heartAnimElapsedMs+=a*1e3;e.heartAnimElapsedMs>=e.playerAnimFrameMs;)e.heartAnimElapsedMs-=e.playerAnimFrameMs,e.heartAnimFrameIndex=(e.heartAnimFrameIndex+1)%e.heartFrames.length;if(!e.isDying&&e.skeletonFrames.length>0)for(e.skeletonAnimElapsedMs+=a*1e3;e.skeletonAnimElapsedMs>=e.playerAnimFrameMs;)e.skeletonAnimElapsedMs-=e.playerAnimFrameMs,e.skeletonAnimFrameIndex=(e.skeletonAnimFrameIndex+1)%e.skeletonFrames.length;if(!e.isDying&&e.blightFrames.length>0)for(e.blightAnimElapsedMs+=a*1e3;e.blightAnimElapsedMs>=e.playerAnimFrameMs;)e.blightAnimElapsedMs-=e.playerAnimFrameMs,e.blightAnimFrameIndex=(e.blightAnimFrameIndex+1)%e.blightFrames.length}function he(e,a){if(e.isDying||(e.spawnTimerSec+=a),!e.isDying&&e.spawnTimerSec>=e.nextSpawnSec){const l=pe(e),r=Math.random();let F;if(e.sinceLastHeartCount<ae?F="negative":e.sinceLastHeartCount>=te?F="collectible":F=r<ee?"collectible":"negative",F==="negative"||e.lifeCount>=3){const s=Math.max(0,Math.min(1,e.elapsedSec/A.scaling.targetSec)),u=Math.max(0,Math.min(.95,ne+.35*s)),p=Math.random()<u,M=Math.max(.1,(e.playerJumpTotalMs||0)/1e3),d=Math.max(A.scaling.minSafeGapSec,.6*M),x=Math.max(20,Math.round(O*d));let h=null;for(let o=e.entities.length-1;o>=0;o--){const H=e.entities[o];if(H.kind==="blight"||H.kind==="skeleton"){h=H;break}}const b=Math.max(x,(h?.width??0)+12),k=Math.max(e.cssW,h?h.x+b:e.cssW);if(p){const o=_.skeleton;e.entities.push({x:k,y:w-o.hitboxH,width:o.hitboxW,height:o.hitboxH,kind:"skeleton"})}else{const o=_.blight;e.entities.push({x:k,y:w-o.hitboxH,width:o.hitboxW,height:o.hitboxH,kind:"blight"})}if(e.sinceLastHeartCount+=1,l<=.5&&Math.random()<.25){const o=e.entities[e.entities.length-1],H=Math.max(.1,(e.playerJumpTotalMs||0)/1e3),C=Math.max(A.scaling.minSafeGapSec,.6*H)*1.2,R=Math.max(20,Math.round(O*C)),D=Math.max(R,(o?.width??0)+16),I=(o?o.x:e.cssW)+D;let E=Math.random()<u;if(o&&o.kind==="skeleton"&&E&&(E=!1),o&&o.kind==="blight"&&!E&&(E=!0),E){const S=_.skeleton;e.entities.push({x:I,y:w-S.hitboxH,width:S.hitboxW,height:S.hitboxH,kind:"skeleton"})}else{const S=_.blight;e.entities.push({x:I,y:w-S.hitboxH,width:S.hitboxW,height:S.hitboxH,kind:"blight"})}}}else{const s=_.heart;e.entities.push({x:e.cssW,y:w-s.hitboxH,width:s.hitboxW,height:s.hitboxH,kind:"heart"}),e.sinceLastHeartCount=0}e.spawnTimerSec=0;const y=A.scaling,c=N*l,i=j*l,f=c+Math.random()*Math.max(0,i-c);let m=Math.max(y.minSafeGapSec,f);const g=y.rest;if(e.restCooldownSec<=0&&l<=g.whenMultiplierLE&&Math.random()<g.probability){const s=Math.max(y.minSafeGapSec,y.minSafeGapSec*g.gapMultiplier);m=Math.max(m,s),e.restCooldownSec=g.cooldownSec}e.nextSpawnSec=m}}function ye(e,a){if(e.isDying||(e.coinSpawnTimerSec+=a),!e.isDying&&e.coinNextSpawnSec<=0&&(e.coinNextSpawnSec=L+Math.random()*(z-L)),!e.isDying&&e.coinSpawnTimerSec>=e.coinNextSpawnSec){const l=_.coin,r=l.hitboxH,F=G*G/(2*Math.abs(B)),y=Math.max(0,w-F),c=Math.max(0,y-r);e.entities.push({x:e.cssW,y:c,width:l.hitboxW,height:r,kind:"coin"}),e.coinSpawnTimerSec=0,e.coinNextSpawnSec=L+Math.random()*(z-L)}}function de(e,a){if(!e.isDying)for(let l=e.entities.length-1;l>=0;l--){const r=e.entities[l];if(r.x-=O*a,r.x+r.width<0){e.entities.splice(l,1);continue}if(r.x<e.player.x+e.player.width&&r.x+r.width>e.player.x&&r.y<e.player.y+e.player.height&&r.y+r.height>e.player.y){if(e.isDying)continue;if(r.kind==="heart"||r.kind==="coin"){if(e.entities.splice(l,1),r.kind==="coin"?(e.coinCount+=1,e.uiDirty=!0):r.kind==="heart"&&e.lifeCount<3&&(e.lifeCount+=1,e.uiDirty=!0),r.kind==="coin")try{postMessage({type:"sfx",s:"coin"})}catch{}else if(r.kind==="heart")try{postMessage({type:"sfx",s:"heart"})}catch{}e.playerRewardFrames.length>0&&(e.playerRewardPlaying=!0,e.playerRewardElapsedMs=0,e.playerRewardFrameIndex=0)}else{if(e.entities.splice(l,1),e.lifeCount>0&&(e.lifeCount-=1,e.uiDirty=!0),e.noHitSec=0,e.recentHitCooldownSec=Math.max(e.recentHitCooldownSec,A.scaling.relax.recentHitSecs),r.kind==="blight")try{postMessage({type:"sfx",s:"blight"})}catch{}else if(r.kind==="skeleton")try{postMessage({type:"sfx",s:"skeleton"})}catch{}if(e.lifeCount<=0&&!e.isDying){e.isDying=!0,e.dyingElapsedMs=0,e.gameOverSent=!1,e.pendingJump=!1,e.player.isJumping=!1,e.player.vy=0,e.player.y=w-e.player.height,e.playerHitPlaying=!1,e.playerRewardPlaying=!1;try{postMessage({type:"death"})}catch{}e.playerDyingFrames.length>0&&(e.playerDyingPlaying=!0,e.playerDyingElapsedMs=0,e.playerDyingFrameIndex=0)}else e.playerHitFrames.length>0&&(e.playerHitPlaying=!0,e.playerHitElapsedMs=0,e.playerHitFrameIndex=0)}}}}function fe(e,a){if(e.isDying&&(e.dyingElapsedMs+=a*1e3,!e.gameOverSent&&e.dyingElapsedMs>=e.dyingDurationMs)){e.gameOverSent=!0;try{postMessage({type:"gameover"})}catch{}}}function ge(e,a){e.ctx&&(e.prevPlayerY=e.player.y,ce(e,a),se(e,a),me(e,a),he(e,a),ye(e,a),de(e,a),fe(e,a))}async function ue(e){if(e.ctx&&!(e.playerSprite||e.playerAtlas||e.playerSpriteLoading)&&!(!e.playerSpriteUrl||!e.playerAtlasUrl)){e.playerSpriteLoading=!0;try{const[a,l]=await Promise.all([fetch(e.playerSpriteUrl),fetch(e.playerAtlasUrl)]);if(!a.ok)throw new Error("Failed to fetch player sprite");if(!l.ok)throw new Error("Failed to fetch player atlas");const[r,F]=[await a.blob(),await l.json()],y=await createImageBitmap(r),c=(t,X)=>{const Q=t[1].frame.x??0,Z=X[1].frame.x??0;if(Q!==Z)return Q-Z;const be=parseInt(t[0].split("_")[1]||"0",10),Se=parseInt(X[0].split("_")[1]||"0",10);return be-Se},i=F.frames||{},f=Object.entries(i),m=f.filter(([t])=>t.startsWith("run_")).sort(c),g=f.filter(([t])=>t.startsWith("jump_")).sort(c),s=f.filter(([t])=>t.startsWith("hit_")).sort(c),u=f.filter(([t])=>t.startsWith("dying_")).sort(c),p=f.filter(([t])=>t.startsWith("blight_")).sort(c),M=f.filter(([t])=>t.startsWith("heart_")).sort(c),d=f.filter(([t])=>t.startsWith("coin_")).sort(c),x=f.filter(([t])=>t.startsWith("skeleton_")).sort(c),h=t=>(t||[]).filter(X=>!!i[X]),b=F.animations||{};let k=h(b.run),o=h(b.jump),H=h(b.hit),C=h(b.reward),R=h(b.dying),D=h(b.blight),I=h(b.heart),E=h(b.coin)?.[0],S=h(b.coin),W=h(b.skeleton);(!k||k.length===0)&&(k=m.map(([t])=>t)),(!o||o.length===0)&&(o=g.map(([t])=>t)),(!H||H.length===0)&&(H=s.map(([t])=>t)),(!C||C.length===0)&&(C=Object.keys(i).filter(t=>t.startsWith("reward_")).sort().map(t=>t)),(!R||R.length===0)&&(R=u.map(([t])=>t)),(!D||D.length===0)&&(D=p.map(([t])=>t)),(!I||I.length===0)&&(I=M.map(([t])=>t)),E||(E=d[0]?.[0]),(!S||S.length===0)&&(S=d.map(([t])=>t)),(!W||W.length===0)&&(W=x.map(([t])=>t)),e.playerRunFrames=k,e.playerJumpFrames=o,e.playerHitFrames=H,e.playerRewardFrames=C,e.playerDyingFrames=R,e.blightFrames=D||[],e.heartFrames=I||[],e.coinFrameName=E??null,e.coinFrames=S||[],e.skeletonFrames=W||[],e.playerSprite=y,e.playerAtlas=F}finally{e.playerSpriteLoading=!1}}}function Me(e,a=1,l=1/60){if(!e.ctx||!e.canvas)return;e.transparentBg?e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height):(e.ctx.fillStyle=e.skyColor,e.ctx.fillRect(0,0,e.canvas.width,e.canvas.height));const r=e.cssH*$,F=e.cssH-r,y=Math.round((F-w)*e.scale),c=e.prevPlayerY+(e.player.y-e.prevPlayerY)*a;if(ue(e),e.playerSprite&&e.playerAtlas){let i=null;if(e.isDying&&e.playerDyingFrames&&e.playerDyingFrames.length>0)i=e.playerDyingFrames[Math.max(0,Math.min(e.playerDyingFrames.length-1,e.playerDyingFrameIndex))]||null;else if(e.playerRewardPlaying&&e.playerRewardFrames.length>0)i=e.playerRewardFrames[Math.max(0,Math.min(e.playerRewardFrames.length-1,e.playerRewardFrameIndex))]||null;else if(e.playerHitPlaying&&e.playerHitFrames.length>0)i=e.playerHitFrames[Math.max(0,Math.min(e.playerHitFrames.length-1,e.playerHitFrameIndex))]||null;else if(e.player.isJumping&&e.playerJumpFrames.length>0){const s=e.playerJumpTotalMs||1,u=Math.max(0,Math.min(1,e.playerJumpElapsedMs/s)),p=.1;if(u<p&&e.playerRunFrames.length>0)i=e.playerRunFrames[Math.max(0,Math.min(e.playerRunFrames.length-1,e.playerRunStartIndexAtJump))];else{const M=Math.max(0,Math.min(1,(u-p)/(1-p))),d=e.playerJumpFrames.length,x=Math.max(0,Math.min(d-1,Math.floor(M*(d-1)+1e-6)));i=e.playerJumpFrames[x]}}else e.playerRunFrames.length>0&&(i=e.playerRunFrames[Math.max(0,Math.min(e.playerRunFrames.length-1,e.playerAnimFrameIndex))]);const f=i?e.playerAtlas.frames[i]:void 0,m=f?.frame,g=f?.pivot||{x:.5,y:1};if(m){const s=v.visualHeight,u=m.w/m.h*s,p=e.player.x-g.x*u+v.offsetX,d=c+e.player.height+0-s*g.y,x=Math.round(p*e.scale),h=Math.round(d*e.scale+y),b=Math.max(1,Math.round(u*e.scale)),k=Math.max(1,Math.round(s*e.scale)),o=e.ctx.imageSmoothingEnabled;e.ctx.imageSmoothingEnabled=!1,e.ctx.drawImage(e.playerSprite,m.x,m.y,m.w,m.h,x,h,b,k),e.ctx.imageSmoothingEnabled=o}}else e.ctx.fillStyle="#000",e.ctx.fillRect(Math.round(e.player.x*e.scale),Math.round(c*e.scale+y),Math.round(e.player.width*e.scale),Math.round(e.player.height*e.scale));if(e.debugDrawHitboxes){const i=Math.round(e.player.x*e.scale),f=Math.round(c*e.scale+y),m=Math.round(e.player.width*e.scale),g=Math.round(e.player.height*e.scale);e.ctx.save(),e.ctx.globalAlpha=.3,e.ctx.fillStyle="#ff00ff",e.ctx.fillRect(i,f,m,g),e.ctx.globalAlpha=1,e.ctx.lineWidth=Math.max(1,Math.round(e.scale)),e.ctx.strokeStyle="#ff00ff",e.ctx.strokeRect(i,f,m,g),e.ctx.restore()}if(!e.isDying)for(const i of e.entities){const m=i.x+O*l*(1-a),g=i.y;if(e.playerSprite&&e.playerAtlas&&(i.kind==="blight"||i.kind==="skeleton"||i.kind==="heart"||i.kind==="coin")){const s=i.kind==="blight"?e.blightFrames.length>0?e.blightFrames[Math.max(0,Math.min(e.blightFrames.length-1,e.blightAnimFrameIndex))]:null:i.kind==="skeleton"?e.skeletonFrames.length>0?e.skeletonFrames[Math.max(0,Math.min(e.skeletonFrames.length-1,e.skeletonAnimFrameIndex))]:null:i.kind==="heart"?e.heartFrames.length>0?e.heartFrames[Math.max(0,Math.min(e.heartFrames.length-1,e.heartAnimFrameIndex))]:null:e.coinFrames.length>0?e.coinFrames[Math.max(0,Math.min(e.coinFrames.length-1,e.coinAnimFrameIndex))]:e.coinFrameName,u=s?e.playerAtlas.frames[s]:void 0,p=u?.frame,M=u?.pivot||{x:.5,y:1};if(p){const d=_[i.kind],x=d.visualHeight,h=p.w/p.h*x,b=m-M.x*h+i.width*.5+(d.offsetX||0),o=g+i.height+(d.offsetY||0)-x*M.y,H=Math.round(b*e.scale),C=Math.round(o*e.scale+y),R=Math.max(1,Math.round(h*e.scale)),D=Math.max(1,Math.round(x*e.scale)),I=e.ctx.imageSmoothingEnabled;if(e.ctx.imageSmoothingEnabled=!1,e.ctx.drawImage(e.playerSprite,p.x,p.y,p.w,p.h,H,C,R,D),e.ctx.imageSmoothingEnabled=I,e.debugDrawHitboxes){const E=Math.round(m*e.scale),S=Math.round(g*e.scale+y),W=Math.round(i.width*e.scale),t=Math.round(i.height*e.scale);e.ctx.save(),e.ctx.globalAlpha=.3,e.ctx.fillStyle="#ff00ff",e.ctx.fillRect(E,S,W,t),e.ctx.globalAlpha=1,e.ctx.lineWidth=Math.max(1,Math.round(e.scale)),e.ctx.strokeStyle="#ff00ff",e.ctx.strokeRect(E,S,W,t),e.ctx.restore()}continue}}if(e.ctx.fillStyle=i.kind==="heart"?"#0a0":i.kind==="coin"?"#fc0":"red",e.ctx.fillRect(Math.round(m*e.scale),Math.round(g*e.scale+y),Math.round(i.width*e.scale),Math.round(i.height*e.scale)),e.debugDrawHitboxes){const s=Math.round(m*e.scale),u=Math.round(g*e.scale+y),p=Math.round(i.width*e.scale),M=Math.round(i.height*e.scale);e.ctx.save(),e.ctx.globalAlpha=.3,e.ctx.fillStyle="#ff00ff",e.ctx.fillRect(s,u,p,M),e.ctx.globalAlpha=1,e.ctx.lineWidth=Math.max(1,Math.round(e.scale)),e.ctx.strokeStyle="#ff00ff",e.ctx.strokeRect(s,u,p,M),e.ctx.restore()}}}function Y(){n.ready||(n.ready=!0,postMessage({type:"ready"}))}let P=0,T=0;const J=1e3/60,K=100,xe=5;function Fe(e){if(!n.ready)return;P||(P=e);let a=e-P;P=e,a<0&&(a=0),a>K&&(a=K),T+=a;let l=0;for(;T>=J&&l<xe;)ge(n,J/1e3),T-=J,l++;n.uiElapsedMs+=a,n.uiDirty&&n.uiElapsedMs>=n.uiIntervalMs&&(postMessage({type:"ui",coinCount:n.coinCount,lifeCount:n.lifeCount}),n.uiDirty=!1,n.uiElapsedMs=0);const r=Math.max(0,Math.min(1,T/J));Me(n,r,J/1e3)}onmessage=e=>{const a=e.data||{};switch(a.type){case"init":{n.canvas=a.canvas,n.skyColor=typeof a.skyColor=="string"?a.skyColor:n.skyColor,n.expectResize=!!a.expectResize,n.debugDrawHitboxes=!!a.debugHitboxes;const l=!!a.alpha;if(n.ctx=n.canvas.getContext("2d",{alpha:l}),!n.ctx)return;n.ctx.imageSmoothingEnabled=!1,n.transparentBg=!!a.transparentBg,q(n,a.cssW,a.cssH,a.dpr),n.expectResize?(n.readyTimer&&clearTimeout(n.readyTimer),n.readyTimer=setTimeout(()=>{Y()},200)):Y();break}case"resize":{q(n,a.cssW,a.cssH,a.dpr),n.expectResize&&(n.expectResize=!1,n.readyTimer&&(clearTimeout(n.readyTimer),n.readyTimer=null),Y());break}case"frame":{Fe(typeof a.now=="number"?a.now:performance.now());break}case"vis":{P=0,T=0;break}case"reset":{le(n),P=0,T=0,postMessage({type:"ui",coinCount:n.coinCount,lifeCount:n.lifeCount});break}case"input":{(a.tap||a.space)&&!n.isDying&&n.lifeCount>0&&!n.player.isJumping&&(n.pendingJump=!0);break}}}})();
//# sourceMappingURL=worker.entry-D5jrQFZr.js.map
