(function(){"use strict";const W={hitboxW:20,hitboxH:60,visualHeight:80,offsetX:5},v={blight:{hitboxW:30,hitboxH:40,visualHeight:80,offsetX:4,offsetY:0},skeleton:{hitboxW:20,hitboxH:60,visualHeight:80,offsetX:-7,offsetY:0},heart:{hitboxW:16,hitboxH:16,visualHeight:80,offsetX:0,offsetY:28},coin:{hitboxW:24,hitboxH:24,visualHeight:80,offsetX:0,offsetY:30}},$=160,A=600-50,J=240,L=720/(1/3),G=720,w={obstacles:{intervalMinSec:1,intervalMaxSec:1.9,skeletonInNegativeProb:.35},heart:{baseProb:.01,minGapObs:9,maxGapObs:15},coin:{intervalMinSec:1.5,intervalMaxSec:3},scaling:{targetSec:180,minMultiplier:.4,minSafeGapSec:.7,coinFullScale:100,coinFactor:.25,streakFullSec:30,streakFactor:.125,relax:{whenLifeLE:1,recentHitSecs:5,relaxMultiplier:1.15},rest:{whenMultiplierLE:.7,probability:.4,gapMultiplier:4,cooldownSec:5}}},B=w.obstacles.intervalMinSec,Y=w.obstacles.intervalMaxSec,ee=w.heart.baseProb,ae=w.heart.minGapObs,te=w.heart.maxGapObs,ne=w.obstacles.skeletonInNegativeProb,O=w.coin.intervalMinSec,z=w.coin.intervalMaxSec,U=3072,V=3072,ie=new URL("./runner-sprite-sheet-DHgMcSOn.webp",self.location.href),re=new URL("./runner-sprite-sheet-C2KdOAdB.json",self.location.href),i={ctx:null,canvas:null,cssW:0,cssH:0,scale:1,transparentBg:!1,ready:!1,expectResize:!1,readyTimer:null,coinCount:0,lifeCount:3,uiDirty:!0,uiElapsedMs:0,uiIntervalMs:120,elapsedSec:0,noHitSec:0,recentHitCooldownSec:0,restCooldownSec:0,player:{x:0,y:A-W.hitboxH,width:W.hitboxW,height:W.hitboxH,vy:0,isJumping:!1},entities:[],spawnTimerSec:0,sinceLastHeartCount:0,nextSpawnSec:B+Math.random()*(Y-B),pendingJump:!1,coinSpawnTimerSec:0,coinNextSpawnSec:0,skyColor:"#e0f7fa",debugDrawHitboxes:!1,playerSpriteUrl:ie.toString(),playerAtlasUrl:re.toString(),playerSprite:null,playerAtlas:null,playerSpriteLoading:!1,playerRunFrames:[],playerJumpFrames:[],playerHitFrames:[],playerRewardFrames:[],playerDyingFrames:[],blightFrames:[],heartFrames:[],coinFrameName:null,coinFrames:[],blightAnimElapsedMs:0,blightAnimFrameIndex:0,skeletonFrames:[],heartAnimElapsedMs:0,heartAnimFrameIndex:0,coinAnimElapsedMs:0,coinAnimFrameIndex:0,skeletonAnimElapsedMs:0,skeletonAnimFrameIndex:0,playerAnimFps:12,playerAnimFrameMs:1e3/12,playerAnimElapsedMs:0,playerAnimFrameIndex:0,playerRunStartIndexAtJump:0,playerRunPhaseMsDuringJump:0,playerJumpElapsedMs:0,playerJumpTotalMs:2*Math.abs(G)/Math.abs(L)*1e3,playerHitPlaying:!1,playerHitElapsedMs:0,playerHitFrameIndex:0,playerRewardPlaying:!1,playerRewardElapsedMs:0,playerRewardFrameIndex:0,isDying:!1,dyingElapsedMs:0,dyingDurationMs:2e3,gameOverSent:!1,playerDyingPlaying:!1,playerDyingElapsedMs:0,playerDyingFrameIndex:0,prevPlayerY:A-W.hitboxH};function q(e,a,l,r){e.cssW=Math.max(1,Math.floor(a)),e.cssH=Math.max(1,Math.floor(l));const m=Math.max(r||1,1),M=Math.max(1,e.cssW*e.cssH),t=U*V,S=Math.max(1,Math.sqrt(t/M)),o=e.cssW>=1024||e.cssH>=1024?2:3,y=(h=>Math.max(1,Math.round(h/.25)*.25))(Math.min(m,S,o)),s=U/e.cssW,p=V/e.cssH;let u="dpr",f=y;s<f&&(f=s,u="w"),p<f&&(f=p,u="h"),e.scale=Math.max(1/8,f);let d=0,x=0;u==="h"?(x=Math.max(1,Math.floor(e.cssH*e.scale)),d=Math.max(1,Math.round(x*(e.cssW/e.cssH)))):u==="w"?(d=Math.max(1,Math.floor(e.cssW*e.scale)),x=Math.max(1,Math.round(d*(e.cssH/e.cssW)))):(d=Math.max(1,Math.round(e.cssW*e.scale)),x=Math.max(1,Math.round(e.cssH*e.scale))),!(!e.canvas||!e.ctx)&&(e.canvas.width!==d&&(e.canvas.width=d),e.canvas.height!==x&&(e.canvas.height=x),e.player.x=e.cssW*.14)}function le(e){const a=Math.max(0,Math.min(1,e));return a<.5?2*a*a:1-Math.pow(-2*a+2,2)/2}function oe(e){const a=w.scaling,l=Math.max(0,Math.min(1,e.elapsedSec/a.targetSec)),r=1-(1-a.minMultiplier)*le(l),m=1-a.coinFactor*Math.max(0,Math.min(1,e.coinCount/a.coinFullScale)),M=1-a.streakFactor*Math.max(0,Math.min(1,e.noHitSec/a.streakFullSec));let t=r*m*M;return t=Math.max(a.minMultiplier,Math.min(1,t)),(e.lifeCount<=a.relax.whenLifeLE||e.recentHitCooldownSec>0)&&(t*=a.relax.relaxMultiplier),Math.max(.4,Math.min(1.3,t))}function ce(e,a){e.elapsedSec+=a,e.noHitSec+=a,e.recentHitCooldownSec>0&&(e.recentHitCooldownSec=Math.max(0,e.recentHitCooldownSec-a)),e.restCooldownSec>0&&(e.restCooldownSec=Math.max(0,e.restCooldownSec-a))}function se(e,a){if(e.isDying)e.pendingJump=!1,e.player.isJumping=!1,e.player.vy=0,e.player.y=A-e.player.height;else if(!e.player.isJumping&&e.pendingJump){e.player.isJumping=!0,e.player.vy=-G,e.pendingJump=!1;try{postMessage({type:"sfx",s:"jump"})}catch{}e.playerRunStartIndexAtJump=e.playerAnimFrameIndex,e.playerRunPhaseMsDuringJump=0,e.playerJumpElapsedMs=0}!e.isDying&&e.player.isJumping&&(e.player.vy+=L*a,e.player.y+=e.player.vy*a,e.playerRunPhaseMsDuringJump+=a*1e3,e.playerJumpElapsedMs=Math.min(e.playerJumpTotalMs,e.playerJumpElapsedMs+a*1e3),e.player.y>=A-e.player.height&&(e.player.y=A-e.player.height,e.player.vy=0,e.player.isJumping=!1,e.playerJumpElapsedMs=e.playerJumpTotalMs,e.playerRunFrames.length>0&&(e.playerAnimFrameIndex=0,e.playerAnimElapsedMs=0),e.playerRunPhaseMsDuringJump=0))}function pe(e,a){if(e.playerSprite&&e.playerAtlas){if(e.isDying&&e.playerDyingFrames&&e.playerDyingFrames.length>0)for(e.playerDyingElapsedMs+=a*1e3;e.playerDyingElapsedMs>=e.playerAnimFrameMs;)if(e.playerDyingElapsedMs-=e.playerAnimFrameMs,e.playerDyingFrameIndex+1<e.playerDyingFrames.length)e.playerDyingFrameIndex+=1;else{e.playerDyingPlaying=!1,e.playerDyingFrameIndex=e.playerDyingFrames.length-1;break}else if(e.playerRewardPlaying&&e.playerRewardFrames.length>0)for(e.playerRewardElapsedMs+=a*1e3;e.playerRewardElapsedMs>=e.playerAnimFrameMs;)if(e.playerRewardElapsedMs-=e.playerAnimFrameMs,e.playerRewardFrameIndex+1<e.playerRewardFrames.length)e.playerRewardFrameIndex+=1;else{e.playerRewardPlaying=!1,e.playerRewardFrameIndex=e.playerRewardFrames.length-1;break}else if(e.playerHitPlaying&&e.playerHitFrames.length>0)for(e.playerHitElapsedMs+=a*1e3;e.playerHitElapsedMs>=e.playerAnimFrameMs;)if(e.playerHitElapsedMs-=e.playerAnimFrameMs,e.playerHitFrameIndex+1<e.playerHitFrames.length)e.playerHitFrameIndex+=1;else{e.playerHitPlaying=!1,e.playerHitFrameIndex=e.playerHitFrames.length-1;break}else if(e.playerRunFrames.length>0)if(e.player.isJumping)e.playerAnimFrameIndex=0,e.playerAnimElapsedMs=0;else for(e.playerAnimElapsedMs+=a*1e3;e.playerAnimElapsedMs>=e.playerAnimFrameMs;)e.playerAnimElapsedMs-=e.playerAnimFrameMs,e.playerAnimFrameIndex=(e.playerAnimFrameIndex+1)%e.playerRunFrames.length}if(!e.isDying&&e.coinFrames.length>0)for(e.coinAnimElapsedMs+=a*1e3;e.coinAnimElapsedMs>=e.playerAnimFrameMs;)e.coinAnimElapsedMs-=e.playerAnimFrameMs,e.coinAnimFrameIndex=(e.coinAnimFrameIndex+1)%e.coinFrames.length;if(!e.isDying&&e.heartFrames.length>0)for(e.heartAnimElapsedMs+=a*1e3;e.heartAnimElapsedMs>=e.playerAnimFrameMs;)e.heartAnimElapsedMs-=e.playerAnimFrameMs,e.heartAnimFrameIndex=(e.heartAnimFrameIndex+1)%e.heartFrames.length;if(!e.isDying&&e.skeletonFrames.length>0)for(e.skeletonAnimElapsedMs+=a*1e3;e.skeletonAnimElapsedMs>=e.playerAnimFrameMs;)e.skeletonAnimElapsedMs-=e.playerAnimFrameMs,e.skeletonAnimFrameIndex=(e.skeletonAnimFrameIndex+1)%e.skeletonFrames.length;if(!e.isDying&&e.blightFrames.length>0)for(e.blightAnimElapsedMs+=a*1e3;e.blightAnimElapsedMs>=e.playerAnimFrameMs;)e.blightAnimElapsedMs-=e.playerAnimFrameMs,e.blightAnimFrameIndex=(e.blightAnimFrameIndex+1)%e.blightFrames.length}function me(e,a){if(e.isDying||(e.spawnTimerSec+=a),!e.isDying&&e.spawnTimerSec>=e.nextSpawnSec){const l=oe(e),r=Math.random();let m;if(e.sinceLastHeartCount<ae?m="negative":e.sinceLastHeartCount>=te?m="collectible":m=r<ee?"collectible":"negative",m==="negative"||e.lifeCount>=3){const s=Math.max(0,Math.min(1,e.elapsedSec/w.scaling.targetSec)),p=Math.max(0,Math.min(.95,ne+.35*s)),u=Math.random()<p,f=Math.max(.1,(e.playerJumpTotalMs||0)/1e3),d=Math.max(w.scaling.minSafeGapSec,.6*f),x=Math.max(20,Math.round(J*d));let h=null;for(let c=e.entities.length-1;c>=0;c--){const H=e.entities[c];if(H.kind==="blight"||H.kind==="skeleton"){h=H;break}}const F=Math.max(x,(h?.width??0)+12),k=Math.max(e.cssW,h?h.x+F:e.cssW);if(u){const c=v.skeleton;e.entities.push({x:k,y:A-c.hitboxH,width:c.hitboxW,height:c.hitboxH,kind:"skeleton"})}else{const c=v.blight;e.entities.push({x:k,y:A-c.hitboxH,width:c.hitboxW,height:c.hitboxH,kind:"blight"})}if(e.sinceLastHeartCount+=1,l<=.5&&Math.random()<.25){const c=e.entities[e.entities.length-1],H=Math.max(.1,(e.playerJumpTotalMs||0)/1e3),C=Math.max(w.scaling.minSafeGapSec,.6*H)*1.2,I=Math.max(20,Math.round(J*C)),D=Math.max(I,(c?.width??0)+16),R=(c?c.x:e.cssW)+D;let E=Math.random()<p;if(c&&c.kind==="skeleton"&&E&&(E=!1),c&&c.kind==="blight"&&!E&&(E=!0),E){const b=v.skeleton;e.entities.push({x:R,y:A-b.hitboxH,width:b.hitboxW,height:b.hitboxH,kind:"skeleton"})}else{const b=v.blight;e.entities.push({x:R,y:A-b.hitboxH,width:b.hitboxW,height:b.hitboxH,kind:"blight"})}}}else{const s=v.heart;e.entities.push({x:e.cssW,y:A-s.hitboxH,width:s.hitboxW,height:s.hitboxH,kind:"heart"}),e.sinceLastHeartCount=0}e.spawnTimerSec=0;const M=w.scaling,t=B*l,S=Y*l,o=t+Math.random()*Math.max(0,S-t);let g=Math.max(M.minSafeGapSec,o);const y=M.rest;if(e.restCooldownSec<=0&&l<=y.whenMultiplierLE&&Math.random()<y.probability){const s=Math.max(M.minSafeGapSec,M.minSafeGapSec*y.gapMultiplier);g=Math.max(g,s),e.restCooldownSec=y.cooldownSec}e.nextSpawnSec=g}}function he(e,a){if(e.isDying||(e.coinSpawnTimerSec+=a),!e.isDying&&e.coinNextSpawnSec<=0&&(e.coinNextSpawnSec=O+Math.random()*(z-O)),!e.isDying&&e.coinSpawnTimerSec>=e.coinNextSpawnSec){const l=v.coin,r=l.hitboxH,m=G*G/(2*Math.abs(L)),M=Math.max(0,A-m),t=Math.max(0,M-r);e.entities.push({x:e.cssW,y:t,width:l.hitboxW,height:r,kind:"coin"}),e.coinSpawnTimerSec=0,e.coinNextSpawnSec=O+Math.random()*(z-O)}}function ye(e,a){if(!e.isDying)for(let l=e.entities.length-1;l>=0;l--){const r=e.entities[l];if(r.x-=J*a,r.x+r.width<0){e.entities.splice(l,1);continue}if(r.x<e.player.x+e.player.width&&r.x+r.width>e.player.x&&r.y<e.player.y+e.player.height&&r.y+r.height>e.player.y){if(e.isDying)continue;if(r.kind==="heart"||r.kind==="coin"){if(e.entities.splice(l,1),r.kind==="coin"?(e.coinCount+=1,e.uiDirty=!0):r.kind==="heart"&&e.lifeCount<3&&(e.lifeCount+=1,e.uiDirty=!0),r.kind==="coin")try{postMessage({type:"sfx",s:"coin"})}catch{}else if(r.kind==="heart")try{postMessage({type:"sfx",s:"heart"})}catch{}e.playerRewardFrames.length>0&&(e.playerRewardPlaying=!0,e.playerRewardElapsedMs=0,e.playerRewardFrameIndex=0)}else{if(e.entities.splice(l,1),e.lifeCount>0&&(e.lifeCount-=1,e.uiDirty=!0),e.noHitSec=0,e.recentHitCooldownSec=Math.max(e.recentHitCooldownSec,w.scaling.relax.recentHitSecs),r.kind==="blight")try{postMessage({type:"sfx",s:"blight"})}catch{}else if(r.kind==="skeleton")try{postMessage({type:"sfx",s:"skeleton"})}catch{}if(e.lifeCount<=0&&!e.isDying){e.isDying=!0,e.dyingElapsedMs=0,e.gameOverSent=!1,e.pendingJump=!1,e.player.isJumping=!1,e.player.vy=0,e.player.y=A-e.player.height,e.playerHitPlaying=!1,e.playerRewardPlaying=!1;try{postMessage({type:"death"})}catch{}e.playerDyingFrames.length>0&&(e.playerDyingPlaying=!0,e.playerDyingElapsedMs=0,e.playerDyingFrameIndex=0)}else e.playerHitFrames.length>0&&(e.playerHitPlaying=!0,e.playerHitElapsedMs=0,e.playerHitFrameIndex=0)}}}}function de(e,a){if(e.isDying&&(e.dyingElapsedMs+=a*1e3,!e.gameOverSent&&e.dyingElapsedMs>=e.dyingDurationMs)){e.gameOverSent=!0;try{postMessage({type:"gameover"})}catch{}}}function fe(e,a){e.ctx&&(e.prevPlayerY=e.player.y,ce(e,a),se(e,a),pe(e,a),me(e,a),he(e,a),ye(e,a),de(e,a))}async function ge(e){if(e.ctx&&!(e.playerSprite||e.playerAtlas||e.playerSpriteLoading)&&!(!e.playerSpriteUrl||!e.playerAtlasUrl)){e.playerSpriteLoading=!0;try{const[a,l]=await Promise.all([fetch(e.playerSpriteUrl),fetch(e.playerAtlasUrl)]);if(!a.ok)throw new Error("Failed to fetch player sprite");if(!l.ok)throw new Error("Failed to fetch player atlas");const[r,m]=[await a.blob(),await l.json()],M=await createImageBitmap(r),t=(n,X)=>{const Q=n[1].frame.x??0,Z=X[1].frame.x??0;if(Q!==Z)return Q-Z;const Fe=parseInt(n[0].split("_")[1]||"0",10),be=parseInt(X[0].split("_")[1]||"0",10);return Fe-be},S=m.frames||{},o=Object.entries(S),g=o.filter(([n])=>n.startsWith("run_")).sort(t),y=o.filter(([n])=>n.startsWith("jump_")).sort(t),s=o.filter(([n])=>n.startsWith("hit_")).sort(t),p=o.filter(([n])=>n.startsWith("dying_")).sort(t),u=o.filter(([n])=>n.startsWith("blight_")).sort(t),f=o.filter(([n])=>n.startsWith("heart_")).sort(t),d=o.filter(([n])=>n.startsWith("coin_")).sort(t),x=o.filter(([n])=>n.startsWith("skeleton_")).sort(t),h=n=>(n||[]).filter(X=>!!S[X]),F=m.animations||{};let k=h(F.run),c=h(F.jump),H=h(F.hit),C=h(F.reward),I=h(F.dying),D=h(F.blight),R=h(F.heart),E=h(F.coin)?.[0],b=h(F.coin),_=h(F.skeleton);(!k||k.length===0)&&(k=g.map(([n])=>n)),(!c||c.length===0)&&(c=y.map(([n])=>n)),(!H||H.length===0)&&(H=s.map(([n])=>n)),(!C||C.length===0)&&(C=Object.keys(S).filter(n=>n.startsWith("reward_")).sort().map(n=>n)),(!I||I.length===0)&&(I=p.map(([n])=>n)),(!D||D.length===0)&&(D=u.map(([n])=>n)),(!R||R.length===0)&&(R=f.map(([n])=>n)),E||(E=d[0]?.[0]),(!b||b.length===0)&&(b=d.map(([n])=>n)),(!_||_.length===0)&&(_=x.map(([n])=>n)),e.playerRunFrames=k,e.playerJumpFrames=c,e.playerHitFrames=H,e.playerRewardFrames=C,e.playerDyingFrames=I,e.blightFrames=D||[],e.heartFrames=R||[],e.coinFrameName=E??null,e.coinFrames=b||[],e.skeletonFrames=_||[],e.playerSprite=M,e.playerAtlas=m}finally{e.playerSpriteLoading=!1}}}function ue(e,a=1,l=1/60){if(!e.ctx||!e.canvas)return;e.transparentBg?e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height):(e.ctx.fillStyle=e.skyColor,e.ctx.fillRect(0,0,e.canvas.width,e.canvas.height));const r=e.cssH-$,m=Math.round((r-A)*e.scale),M=e.prevPlayerY+(e.player.y-e.prevPlayerY)*a;if(ge(e),e.playerSprite&&e.playerAtlas){let t=null;if(e.isDying&&e.playerDyingFrames&&e.playerDyingFrames.length>0)t=e.playerDyingFrames[Math.max(0,Math.min(e.playerDyingFrames.length-1,e.playerDyingFrameIndex))]||null;else if(e.playerRewardPlaying&&e.playerRewardFrames.length>0)t=e.playerRewardFrames[Math.max(0,Math.min(e.playerRewardFrames.length-1,e.playerRewardFrameIndex))]||null;else if(e.playerHitPlaying&&e.playerHitFrames.length>0)t=e.playerHitFrames[Math.max(0,Math.min(e.playerHitFrames.length-1,e.playerHitFrameIndex))]||null;else if(e.player.isJumping&&e.playerJumpFrames.length>0){const y=e.playerJumpTotalMs||1,s=Math.max(0,Math.min(1,e.playerJumpElapsedMs/y)),p=.1;if(s<p&&e.playerRunFrames.length>0)t=e.playerRunFrames[Math.max(0,Math.min(e.playerRunFrames.length-1,e.playerRunStartIndexAtJump))];else{const u=Math.max(0,Math.min(1,(s-p)/(1-p))),f=e.playerJumpFrames.length,d=Math.max(0,Math.min(f-1,Math.floor(u*(f-1)+1e-6)));t=e.playerJumpFrames[d]}}else e.playerRunFrames.length>0&&(t=e.playerRunFrames[Math.max(0,Math.min(e.playerRunFrames.length-1,e.playerAnimFrameIndex))]);const S=t?e.playerAtlas.frames[t]:void 0,o=S?.frame,g=S?.pivot||{x:.5,y:1};if(o){const y=W.visualHeight,s=o.w/o.h*y,p=e.player.x-g.x*s+W.offsetX,f=M+e.player.height+0-y*g.y,d=Math.round(p*e.scale),x=Math.round(f*e.scale+m),h=Math.max(1,Math.round(s*e.scale)),F=Math.max(1,Math.round(y*e.scale)),k=e.ctx.imageSmoothingEnabled;e.ctx.imageSmoothingEnabled=!1,e.ctx.drawImage(e.playerSprite,o.x,o.y,o.w,o.h,d,x,h,F),e.ctx.imageSmoothingEnabled=k}}else e.ctx.fillStyle="#000",e.ctx.fillRect(Math.round(e.player.x*e.scale),Math.round(M*e.scale+m),Math.round(e.player.width*e.scale),Math.round(e.player.height*e.scale));if(e.debugDrawHitboxes){const t=Math.round(e.player.x*e.scale),S=Math.round(M*e.scale+m),o=Math.round(e.player.width*e.scale),g=Math.round(e.player.height*e.scale);e.ctx.save(),e.ctx.globalAlpha=.3,e.ctx.fillStyle="#ff00ff",e.ctx.fillRect(t,S,o,g),e.ctx.globalAlpha=1,e.ctx.lineWidth=Math.max(1,Math.round(e.scale)),e.ctx.strokeStyle="#ff00ff",e.ctx.strokeRect(t,S,o,g),e.ctx.restore()}if(!e.isDying)for(const t of e.entities){const o=t.x+J*l*(1-a),g=t.y;if(e.playerSprite&&e.playerAtlas&&(t.kind==="blight"||t.kind==="skeleton"||t.kind==="heart"||t.kind==="coin")){const y=t.kind==="blight"?e.blightFrames.length>0?e.blightFrames[Math.max(0,Math.min(e.blightFrames.length-1,e.blightAnimFrameIndex))]:null:t.kind==="skeleton"?e.skeletonFrames.length>0?e.skeletonFrames[Math.max(0,Math.min(e.skeletonFrames.length-1,e.skeletonAnimFrameIndex))]:null:t.kind==="heart"?e.heartFrames.length>0?e.heartFrames[Math.max(0,Math.min(e.heartFrames.length-1,e.heartAnimFrameIndex))]:null:e.coinFrames.length>0?e.coinFrames[Math.max(0,Math.min(e.coinFrames.length-1,e.coinAnimFrameIndex))]:e.coinFrameName,s=y?e.playerAtlas.frames[y]:void 0,p=s?.frame,u=s?.pivot||{x:.5,y:1};if(p){const f=v[t.kind],d=f.visualHeight,x=p.w/p.h*d,h=o-u.x*x+t.width*.5+(f.offsetX||0),k=g+t.height+(f.offsetY||0)-d*u.y,c=Math.round(h*e.scale),H=Math.round(k*e.scale+m),C=Math.max(1,Math.round(x*e.scale)),I=Math.max(1,Math.round(d*e.scale)),D=e.ctx.imageSmoothingEnabled;if(e.ctx.imageSmoothingEnabled=!1,e.ctx.drawImage(e.playerSprite,p.x,p.y,p.w,p.h,c,H,C,I),e.ctx.imageSmoothingEnabled=D,e.debugDrawHitboxes){const R=Math.round(o*e.scale),E=Math.round(g*e.scale+m),b=Math.round(t.width*e.scale),_=Math.round(t.height*e.scale);e.ctx.save(),e.ctx.globalAlpha=.3,e.ctx.fillStyle="#ff00ff",e.ctx.fillRect(R,E,b,_),e.ctx.globalAlpha=1,e.ctx.lineWidth=Math.max(1,Math.round(e.scale)),e.ctx.strokeStyle="#ff00ff",e.ctx.strokeRect(R,E,b,_),e.ctx.restore()}continue}}if(e.ctx.fillStyle=t.kind==="heart"?"#0a0":t.kind==="coin"?"#fc0":"red",e.ctx.fillRect(Math.round(o*e.scale),Math.round(g*e.scale+m),Math.round(t.width*e.scale),Math.round(t.height*e.scale)),e.debugDrawHitboxes){const y=Math.round(o*e.scale),s=Math.round(g*e.scale+m),p=Math.round(t.width*e.scale),u=Math.round(t.height*e.scale);e.ctx.save(),e.ctx.globalAlpha=.3,e.ctx.fillStyle="#ff00ff",e.ctx.fillRect(y,s,p,u),e.ctx.globalAlpha=1,e.ctx.lineWidth=Math.max(1,Math.round(e.scale)),e.ctx.strokeStyle="#ff00ff",e.ctx.strokeRect(y,s,p,u),e.ctx.restore()}}}function j(){i.ready||(i.ready=!0,postMessage({type:"ready"}))}let T=0,N=0;const P=1e3/60,K=100,Me=5;function xe(e){if(!i.ready)return;T||(T=e);let a=e-T;T=e,a<0&&(a=0),a>K&&(a=K),N+=a;let l=0;for(;N>=P&&l<Me;)fe(i,P/1e3),N-=P,l++;i.uiElapsedMs+=a,i.uiDirty&&i.uiElapsedMs>=i.uiIntervalMs&&(postMessage({type:"ui",coinCount:i.coinCount,lifeCount:i.lifeCount}),i.uiDirty=!1,i.uiElapsedMs=0);const r=Math.max(0,Math.min(1,N/P));ue(i,r,P/1e3)}onmessage=e=>{const a=e.data||{};switch(a.type){case"init":{i.canvas=a.canvas,i.skyColor=typeof a.skyColor=="string"?a.skyColor:i.skyColor,i.expectResize=!!a.expectResize,i.debugDrawHitboxes=!!a.debugHitboxes;const l=!!a.alpha;if(i.ctx=i.canvas.getContext("2d",{alpha:l}),!i.ctx)return;i.ctx.imageSmoothingEnabled=!1,i.transparentBg=!!a.transparentBg,q(i,a.cssW,a.cssH,a.dpr),i.expectResize?(i.readyTimer&&clearTimeout(i.readyTimer),i.readyTimer=setTimeout(()=>{j()},200)):j();break}case"resize":{q(i,a.cssW,a.cssH,a.dpr),i.expectResize&&(i.expectResize=!1,i.readyTimer&&(clearTimeout(i.readyTimer),i.readyTimer=null),j());break}case"frame":{xe(typeof a.now=="number"?a.now:performance.now());break}case"vis":{T=0,N=0;break}case"input":{(a.tap||a.space)&&!i.isDying&&i.lifeCount>0&&!i.player.isJumping&&(i.pendingJump=!0);break}}}})();
//# sourceMappingURL=worker.entry-ej0Y3R0n.js.map
