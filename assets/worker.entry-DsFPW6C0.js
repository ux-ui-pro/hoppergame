(function(){"use strict";const b={obstacles:{intervalMinSec:1,intervalMaxSec:1.9,skeletonInNegativeProb:.35},heart:{baseProb:.01,minGapObs:9,maxGapObs:15},coin:{intervalMinSec:1.5,intervalMaxSec:3},scaling:{targetSec:180,minSafeGapSec:.7,relax:{recentHitSecs:5}}},T=b.obstacles.intervalMinSec,Y=b.obstacles.intervalMaxSec,K=b.heart.baseProb,Z=b.heart.minGapObs,$=b.heart.maxGapObs,ee=b.obstacles.skeletonInNegativeProb,O=b.coin.intervalMinSec,G=b.coin.intervalMaxSec,U=3072,L=3072,_={hitboxW:20,hitboxH:60,visualHeight:80,offsetX:5},C={blight:{hitboxW:30,hitboxH:40,visualHeight:80,offsetX:4,offsetY:0},skeleton:{hitboxW:20,hitboxH:60,visualHeight:80,offsetX:-7,offsetY:0},heart:{hitboxW:16,hitboxH:16,visualHeight:80,offsetX:0,offsetY:28},coin:{hitboxW:24,hitboxH:24,visualHeight:80,offsetX:0,offsetY:30}},ae=160,te=new URL("./runner-sprite-sheet-DHgMcSOn.webp",self.location.href),ne=new URL("./runner-sprite-sheet-BAre8VZS.json",self.location.href),r={ctx:null,canvas:null,cssW:0,cssH:0,scale:1,transparentBg:!1,ready:!1,expectResize:!1,readyTimer:null,coinCount:0,lifeCount:3,uiDirty:!0,uiElapsedMs:0,uiIntervalMs:120,elapsedSec:0,noHitSec:0,recentHitCooldownSec:0,restCooldownSec:0,speedMultiplier:1,scrollSpeedX:0,speedNotifyCooldownMs:0,player:{x:0,y:550-_.hitboxH,width:_.hitboxW,height:_.hitboxH,vy:0,isJumping:!1},entities:[],spawnTimerSec:0,sinceLastHeartCount:0,nextSpawnSec:T+Math.random()*(Y-T),pendingJump:!1,jumpQueuedMs:0,coyoteRemainingMs:0,hasUsedDoubleJump:!1,coinSpawnTimerSec:0,coinNextSpawnSec:0,skyColor:"#e0f7fa",debugDrawHitboxes:!1,playerSpriteUrl:te.toString(),playerAtlasUrl:ne.toString(),playerSprite:null,playerAtlas:null,playerSpriteLoading:!1,playerRunFrames:[],playerJumpFrames:[],playerHitFrames:[],playerRewardFrames:[],playerDyingFrames:[],blightFrames:[],heartFrames:[],coinFrameName:null,coinFrames:[],blightAnimElapsedMs:0,blightAnimFrameIndex:0,skeletonFrames:[],heartAnimElapsedMs:0,heartAnimFrameIndex:0,coinAnimElapsedMs:0,coinAnimFrameIndex:0,skeletonAnimElapsedMs:0,skeletonAnimFrameIndex:0,playerAnimFps:12,playerAnimFrameMs:1e3/12,playerAnimElapsedMs:0,playerAnimFrameIndex:0,playerRunStartIndexAtJump:0,playerRunPhaseMsDuringJump:0,playerJumpElapsedMs:0,playerJumpTotalMs:2*Math.abs(720)/Math.abs(2160)*1e3,playerHitPlaying:!1,playerHitElapsedMs:0,playerHitFrameIndex:0,playerRewardPlaying:!1,playerRewardElapsedMs:0,playerRewardFrameIndex:0,isDying:!1,dyingElapsedMs:0,dyingDurationMs:2e3,gameOverSent:!1,playerDyingPlaying:!1,playerDyingElapsedMs:0,playerDyingFrameIndex:0,prevPlayerY:550-_.hitboxH};function B(e,a,y,F){e.cssW=Math.max(1,Math.floor(a)),e.cssH=Math.max(1,Math.floor(y));const M=Math.max(F||1,1),H=Math.max(1,e.cssW*e.cssH),t=U*L,n=Math.max(1,Math.sqrt(t/H)),s=e.cssW>=1024||e.cssH>=1024?2:3,c=(f=>Math.max(1,Math.round(f/.25)*.25))(Math.min(M,n,s)),d=U/e.cssW,p=L/e.cssH;let g="dpr",m=c;d<m&&(m=d,g="w"),p<m&&(m=p,g="h"),e.scale=Math.max(1/8,m);let u=0,o=0;g==="h"?(o=Math.max(1,Math.floor(e.cssH*e.scale)),u=Math.max(1,Math.round(o*(e.cssW/e.cssH)))):g==="w"?(u=Math.max(1,Math.floor(e.cssW*e.scale)),o=Math.max(1,Math.round(u*(e.cssH/e.cssW)))):(u=Math.max(1,Math.round(e.cssW*e.scale)),o=Math.max(1,Math.round(e.cssH*e.scale))),!(!e.canvas||!e.ctx)&&(e.canvas.width!==u&&(e.canvas.width=u),e.canvas.height!==o&&(e.canvas.height=o),e.player.x=e.cssW*.14)}const v={startMultiplier:1,maxMultiplier:2.2,accelDurationSec:90,notifyIntervalMs:150};function ie(e){const a=Math.max(0,Math.min(1,e/v.accelDurationSec)),y=a<.5?2*a*a:1-Math.pow(-2*a+2,2)/2,F=v.maxMultiplier-v.startMultiplier;return Math.max(v.startMultiplier,Math.min(v.maxMultiplier,v.startMultiplier+y*F))}const N={startSec:.65,minSec:.35,durationSec:90};function V(e){const a=Math.max(0,Math.min(1,e/N.durationSec)),y=a<.5?2*a*a:1-Math.pow(-2*a+2,2)/2,F=Math.max(0,N.startSec-N.minSec);return Math.max(N.minSec,N.startSec-y*F)}function re(e,a){if(!e.ctx)return;e.prevPlayerY=e.player.y,e.elapsedSec+=a,e.noHitSec+=a,e.recentHitCooldownSec>0&&(e.recentHitCooldownSec=Math.max(0,e.recentHitCooldownSec-a)),e.restCooldownSec>0&&(e.restCooldownSec=Math.max(0,e.restCooldownSec-a));const y=ie(e.elapsedSec);if(e.speedMultiplier=y,e.scrollSpeedX=240*y,e.speedNotifyCooldownMs=Math.max(0,(e.speedNotifyCooldownMs||0)-a*1e3),e.speedNotifyCooldownMs<=0){try{postMessage({type:"speed",m:y})}catch{}e.speedNotifyCooldownMs=v.notifyIntervalMs}const F=120,M=100,H=150;if(!e.isDying&&e.pendingJump&&(e.pendingJump=!1,e.jumpQueuedMs=Math.max(e.jumpQueuedMs||0,F)),e.isDying||(e.jumpQueuedMs=Math.max(0,(e.jumpQueuedMs||0)-a*1e3),e.coyoteRemainingMs=Math.max(0,(e.coyoteRemainingMs||0)-a*1e3)),e.isDying)e.pendingJump=!1,e.player.isJumping=!1,e.player.vy=0,e.player.y=550-e.player.height;else{const t=!e.player.isJumping||(e.coyoteRemainingMs||0)>0,n=e.player.isJumping&&!e.hasUsedDoubleJump&&(e.playerJumpElapsedMs||0)>=H;if((e.jumpQueuedMs||0)>0&&(t||n)){e.jumpQueuedMs=0;const s=t;if(e.player.isJumping=!0,e.player.vy=-720,s){e.hasUsedDoubleJump=!1,e.coyoteRemainingMs=0;try{postMessage({type:"sfx",s:"jump"})}catch{}e.playerRunStartIndexAtJump=e.playerAnimFrameIndex,e.playerRunPhaseMsDuringJump=0,e.playerJumpElapsedMs=0}else{e.hasUsedDoubleJump=!0;try{postMessage({type:"sfx",s:"jump"})}catch{}}}}if(!e.isDying&&e.player.isJumping&&(e.player.vy+=2160*a,e.player.y+=e.player.vy*a,e.playerRunPhaseMsDuringJump+=a*1e3,e.playerJumpElapsedMs=Math.min(e.playerJumpTotalMs,e.playerJumpElapsedMs+a*1e3),e.player.y>=550-e.player.height&&(e.player.y=550-e.player.height,e.player.vy=0,e.player.isJumping=!1,e.playerJumpElapsedMs=e.playerJumpTotalMs,e.hasUsedDoubleJump=!1,e.coyoteRemainingMs=M,e.playerRunFrames.length>0&&(e.playerAnimFrameIndex=0,e.playerAnimElapsedMs=0),e.playerRunPhaseMsDuringJump=0)),e.playerSprite&&e.playerAtlas){if(e.isDying&&e.playerDyingFrames&&e.playerDyingFrames.length>0)for(e.playerDyingElapsedMs+=a*1e3;e.playerDyingElapsedMs>=e.playerAnimFrameMs;)if(e.playerDyingElapsedMs-=e.playerAnimFrameMs,e.playerDyingFrameIndex+1<e.playerDyingFrames.length)e.playerDyingFrameIndex+=1;else{e.playerDyingPlaying=!1,e.playerDyingFrameIndex=e.playerDyingFrames.length-1;break}else if(e.playerRewardPlaying&&e.playerRewardFrames.length>0)for(e.playerRewardElapsedMs+=a*1e3;e.playerRewardElapsedMs>=e.playerAnimFrameMs;)if(e.playerRewardElapsedMs-=e.playerAnimFrameMs,e.playerRewardFrameIndex+1<e.playerRewardFrames.length)e.playerRewardFrameIndex+=1;else{e.playerRewardPlaying=!1,e.playerRewardFrameIndex=e.playerRewardFrames.length-1;break}else if(e.playerHitPlaying&&e.playerHitFrames.length>0)for(e.playerHitElapsedMs+=a*1e3;e.playerHitElapsedMs>=e.playerAnimFrameMs;)if(e.playerHitElapsedMs-=e.playerAnimFrameMs,e.playerHitFrameIndex+1<e.playerHitFrames.length)e.playerHitFrameIndex+=1;else{e.playerHitPlaying=!1,e.playerHitFrameIndex=e.playerHitFrames.length-1;break}else if(e.playerRunFrames.length>0)if(e.player.isJumping)e.playerAnimFrameIndex=0,e.playerAnimElapsedMs=0;else for(e.playerAnimElapsedMs+=a*1e3;e.playerAnimElapsedMs>=e.playerAnimFrameMs;)e.playerAnimElapsedMs-=e.playerAnimFrameMs,e.playerAnimFrameIndex=(e.playerAnimFrameIndex+1)%e.playerRunFrames.length}if(!e.isDying&&e.coinFrames.length>0)for(e.coinAnimElapsedMs+=a*1e3;e.coinAnimElapsedMs>=e.playerAnimFrameMs;)e.coinAnimElapsedMs-=e.playerAnimFrameMs,e.coinAnimFrameIndex=(e.coinAnimFrameIndex+1)%e.coinFrames.length;if(!e.isDying&&e.heartFrames.length>0)for(e.heartAnimElapsedMs+=a*1e3;e.heartAnimElapsedMs>=e.playerAnimFrameMs;)e.heartAnimElapsedMs-=e.playerAnimFrameMs,e.heartAnimFrameIndex=(e.heartAnimFrameIndex+1)%e.heartFrames.length;if(!e.isDying&&e.skeletonFrames.length>0)for(e.skeletonAnimElapsedMs+=a*1e3;e.skeletonAnimElapsedMs>=e.playerAnimFrameMs;)e.skeletonAnimElapsedMs-=e.playerAnimFrameMs,e.skeletonAnimFrameIndex=(e.skeletonAnimFrameIndex+1)%e.skeletonFrames.length;if(!e.isDying&&e.blightFrames&&e.blightFrames.length>0)for(e.blightAnimElapsedMs+=a*1e3;e.blightAnimElapsedMs>=e.playerAnimFrameMs;)e.blightAnimElapsedMs-=e.playerAnimFrameMs,e.blightAnimFrameIndex=(e.blightAnimFrameIndex+1)%e.blightFrames.length;if(e.isDying||(e.spawnTimerSec+=a),!e.isDying&&e.spawnTimerSec>=e.nextSpawnSec){const t=Math.random();let n;if(e.sinceLastHeartCount<Z?n="negative":e.sinceLastHeartCount>=$?n="collectible":n=t<K?"collectible":"negative",n==="negative"||e.lifeCount>=3){const h=Math.max(0,Math.min(1,e.elapsedSec/b.scaling.targetSec)),c=Math.max(0,Math.min(.95,ee+.35*h)),d=Math.random()<c,p=Math.max(.1,(e.playerJumpTotalMs||0)/1e3),g=V(e.elapsedSec),m=Math.max(b.scaling.minSafeGapSec,.6*p,g),u=Math.max(20,Math.round((e.scrollSpeedX||240)*m));let o=null;for(let l=e.entities.length-1;l>=0;l--){const w=e.entities[l];if(w.kind==="blight"||w.kind==="skeleton"){o=w;break}}const f=Math.max(u,(o?.width??0)+12),A=Math.max(e.cssW,o?o.x+f:e.cssW);if(d){const l=C.skeleton;e.entities.push({x:A,y:550-l.hitboxH,width:l.hitboxW,height:l.hitboxH,kind:"skeleton"})}else{const l=C.blight;e.entities.push({x:A,y:550-l.hitboxH,width:l.hitboxW,height:l.hitboxH,kind:"blight"})}if(e.sinceLastHeartCount+=1,Math.random()<.1){const l=e.entities[e.entities.length-1],w=Math.max(.1,(e.playerJumpTotalMs||0)/1e3),k=V(e.elapsedSec),D=Math.max(b.scaling.minSafeGapSec,.6*w,k)*1.2,R=Math.max(20,Math.round((e.scrollSpeedX||240)*D)),I=Math.max(R,(l?.width??0)+16),E=(l?l.x:e.cssW)+I;let S=Math.random()<c;if(l&&l.kind==="skeleton"&&S&&(S=!1),l&&l.kind==="blight"&&!S&&(S=!0),S){const x=C.skeleton;e.entities.push({x:E,y:550-x.hitboxH,width:x.hitboxW,height:x.hitboxH,kind:"skeleton"})}else{const x=C.blight;e.entities.push({x:E,y:550-x.hitboxH,width:x.hitboxW,height:x.hitboxH,kind:"blight"})}}}else{const h=C.heart,c=h.hitboxH,p=2*(720*720/(2*Math.abs(2160))),g=Math.max(0,550-p),m=Math.max(0,g-c);e.entities.push({x:e.cssW,y:m,width:h.hitboxW,height:c,kind:"heart"}),e.sinceLastHeartCount=0}e.spawnTimerSec=0;const s=T+Math.random()*Math.max(0,Y-T);e.nextSpawnSec=Math.max(b.scaling.minSafeGapSec,s)}if(e.isDying||(e.coinSpawnTimerSec+=a),!e.isDying&&e.coinNextSpawnSec<=0&&(e.coinNextSpawnSec=O+Math.random()*(G-O)),!e.isDying&&e.coinSpawnTimerSec>=e.coinNextSpawnSec){const t=C.coin,n=t.hitboxH,s=720*720/(2*Math.abs(2160)),h=Math.max(0,550-s),c=Math.max(0,h-n);e.entities.push({x:e.cssW,y:c,width:t.hitboxW,height:n,kind:"coin"}),e.coinSpawnTimerSec=0,e.coinNextSpawnSec=O+Math.random()*(G-O)}if(!e.isDying)for(let t=e.entities.length-1;t>=0;t--){const n=e.entities[t];if(n.x-=(e.scrollSpeedX||240)*a,n.x+n.width<0){e.entities.splice(t,1);continue}if(n.x<e.player.x+e.player.width&&n.x+n.width>e.player.x&&n.y<e.player.y+e.player.height&&n.y+n.height>e.player.y){if(e.isDying)continue;if(n.kind==="heart"||n.kind==="coin"){if(e.entities.splice(t,1),n.kind==="coin"?(e.coinCount+=1,e.uiDirty=!0):n.kind==="heart"&&e.lifeCount<3&&(e.lifeCount+=1,e.uiDirty=!0),n.kind==="coin")try{postMessage({type:"sfx",s:"coin"})}catch{}else if(n.kind==="heart")try{postMessage({type:"sfx",s:"heart"})}catch{}e.playerRewardFrames.length>0&&(e.playerRewardPlaying=!0,e.playerRewardElapsedMs=0,e.playerRewardFrameIndex=0)}else{if(e.entities.splice(t,1),e.lifeCount>0&&(e.lifeCount-=1,e.uiDirty=!0),e.noHitSec=0,e.recentHitCooldownSec=Math.max(e.recentHitCooldownSec,b.scaling.relax.recentHitSecs),n.kind==="blight")try{postMessage({type:"sfx",s:"blight"})}catch{}else if(n.kind==="skeleton")try{postMessage({type:"sfx",s:"skeleton"})}catch{}if(e.lifeCount<=0&&!e.isDying){e.isDying=!0,e.dyingElapsedMs=0,e.gameOverSent=!1,e.pendingJump=!1,e.player.isJumping=!1,e.player.vy=0,e.player.y=550-e.player.height,e.playerHitPlaying=!1,e.playerRewardPlaying=!1;try{postMessage({type:"death"})}catch{}e.playerDyingFrames.length>0&&(e.playerDyingPlaying=!0,e.playerDyingElapsedMs=0,e.playerDyingFrameIndex=0)}else e.playerHitFrames.length>0&&(e.playerHitPlaying=!0,e.playerHitElapsedMs=0,e.playerHitFrameIndex=0)}}}if(e.isDying&&(e.dyingElapsedMs+=a*1e3,!e.gameOverSent&&e.dyingElapsedMs>=e.dyingDurationMs)){e.gameOverSent=!0;try{postMessage({type:"gameover"})}catch{}}}async function le(e){if(e.ctx&&!(e.playerSprite||e.playerAtlas||e.playerSpriteLoading)&&!(!e.playerSpriteUrl||!e.playerAtlasUrl)){e.playerSpriteLoading=!0;try{const[a,y]=await Promise.all([fetch(e.playerSpriteUrl),fetch(e.playerAtlasUrl)]);if(!a.ok)throw new Error("Failed to fetch player sprite");if(!y.ok)throw new Error("Failed to fetch player atlas");const[F,M]=[await a.blob(),await y.json()],H=await createImageBitmap(F),t=(i,j)=>{const Q=i[1].frame?.x??0,q=j[1].frame?.x??0;if(Q!==q)return Q-q;const ce=parseInt(i[0].split("_")[1]||"0",10),me=parseInt(j[0].split("_")[1]||"0",10);return ce-me},n=M.frames||{},s=Object.entries(n).filter(([i])=>i.startsWith("run_")).sort(t),h=Object.entries(n).filter(([i])=>i.startsWith("jump_")).sort(t),c=Object.entries(n).filter(([i])=>i.startsWith("hit_")).sort(t),d=Object.entries(n).filter(([i])=>i.startsWith("dying_")).sort(t),p=Object.entries(n).filter(([i])=>i.startsWith("blight_")).sort(t),g=Object.entries(n).filter(([i])=>i.startsWith("heart_")).sort(t),m=Object.entries(n).filter(([i])=>i.startsWith("coin_")).sort(t),u=Object.entries(n).filter(([i])=>i.startsWith("skeleton_")).sort(t),o=i=>(i||[]).filter(j=>!!n[j]),f=M.animations||{};let A=o(f.run),l=o(f.jump),w=o(f.hit),k=o(f.reward),D=o(f.dying),R=o(f.blight),I=o(f.heart),E=o(f.coin)?.[0],S=o(f.coin),x=o(f.skeleton);(!A||A.length===0)&&(A=s.map(([i])=>i)),(!l||l.length===0)&&(l=h.map(([i])=>i)),(!w||w.length===0)&&(w=c.map(([i])=>i)),(!k||k.length===0)&&(k=Object.keys(n).filter(i=>i.startsWith("reward_")).sort().map(i=>i)),(!D||D.length===0)&&(D=d.map(([i])=>i)),(!R||R.length===0)&&(R=p.map(([i])=>i)),(!I||I.length===0)&&(I=g.map(([i])=>i)),E||(E=m[0]?.[0]),(!S||S.length===0)&&(S=m.map(([i])=>i)),(!x||x.length===0)&&(x=u.map(([i])=>i)),e.playerRunFrames=A,e.playerJumpFrames=l,e.playerHitFrames=w,e.playerRewardFrames=k,e.playerDyingFrames=D,e.blightFrames=R||[],e.heartFrames=I||[],e.coinFrameName=E??null,e.coinFrames=S||[],e.skeletonFrames=x||[],e.playerSprite=H,e.playerAtlas=M}finally{e.playerSpriteLoading=!1}}}function oe(e,a=1,y=1/60){if(!e.ctx||!e.canvas)return;e.transparentBg?e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height):(e.ctx.fillStyle=e.skyColor,e.ctx.fillRect(0,0,e.canvas.width,e.canvas.height));const F=e.cssH-ae,M=Math.round((F-550)*e.scale),H=e.prevPlayerY+(e.player.y-e.prevPlayerY)*a;if(le(e),e.playerSprite&&e.playerAtlas){let t=null;if(e.isDying&&e.playerDyingFrames&&e.playerDyingFrames.length>0)t=e.playerDyingFrames[Math.max(0,Math.min(e.playerDyingFrames.length-1,e.playerDyingFrameIndex))]||null;else if(e.playerRewardPlaying&&e.playerRewardFrames.length>0)t=e.playerRewardFrames[Math.max(0,Math.min(e.playerRewardFrames.length-1,e.playerRewardFrameIndex))]||null;else if(e.playerHitPlaying&&e.playerHitFrames.length>0)t=e.playerHitFrames[Math.max(0,Math.min(e.playerHitFrames.length-1,e.playerHitFrameIndex))]||null;else if(e.player.isJumping&&e.playerJumpFrames.length>0){const c=e.playerJumpTotalMs||1,d=Math.max(0,Math.min(1,e.playerJumpElapsedMs/c)),p=.1;if(d<p&&e.playerRunFrames.length>0)t=e.playerRunFrames[Math.max(0,Math.min(e.playerRunFrames.length-1,e.playerRunStartIndexAtJump))];else{const g=Math.max(0,Math.min(1,(d-p)/(1-p))),m=e.playerJumpFrames.length,u=Math.max(0,Math.min(m-1,Math.floor(g*(m-1)+1e-6)));t=e.playerJumpFrames[u]}}else e.playerRunFrames.length>0&&(t=e.playerRunFrames[Math.max(0,Math.min(e.playerRunFrames.length-1,e.playerAnimFrameIndex))]);const n=t?e.playerAtlas.frames[t]:void 0,s=n?.frame,h=n?.pivot||{x:.5,y:1};if(s){const c=_.visualHeight,d=s.w/s.h*c,p=e.player.x-h.x*d+_.offsetX,m=H+e.player.height+0-c*h.y,u=Math.round(p*e.scale),o=Math.round(m*e.scale+M),f=Math.max(1,Math.round(d*e.scale)),A=Math.max(1,Math.round(c*e.scale)),l=e.ctx.imageSmoothingEnabled;e.ctx.imageSmoothingEnabled=!1,e.ctx.drawImage(e.playerSprite,s.x,s.y,s.w,s.h,u,o,f,A),e.ctx.imageSmoothingEnabled=l}}else e.ctx.fillStyle="#000",e.ctx.fillRect(Math.round(e.player.x*e.scale),Math.round(H*e.scale+M),Math.round(e.player.width*e.scale),Math.round(e.player.height*e.scale));if(e.debugDrawHitboxes){const t=Math.round(e.player.x*e.scale),n=Math.round(H*e.scale+M),s=Math.round(e.player.width*e.scale),h=Math.round(e.player.height*e.scale);e.ctx.save(),e.ctx.globalAlpha=.3,e.ctx.fillStyle="#ff00ff",e.ctx.fillRect(t,n,s,h),e.ctx.globalAlpha=1,e.ctx.lineWidth=Math.max(1,Math.round(e.scale)),e.ctx.strokeStyle="#ff00ff",e.ctx.strokeRect(t,n,s,h),e.ctx.restore()}if(!e.isDying)for(const t of e.entities){const s=t.x+240*y*(1-a),h=t.y;if(e.playerSprite&&e.playerAtlas&&(t.kind==="blight"||t.kind==="skeleton"||t.kind==="heart"||t.kind==="coin")){const c=t.kind==="blight"?e.blightFrames.length>0?e.blightFrames[Math.max(0,Math.min(e.blightFrames.length-1,e.blightAnimFrameIndex))]:null:t.kind==="skeleton"?e.skeletonFrames.length>0?e.skeletonFrames[Math.max(0,Math.min(e.skeletonFrames.length-1,e.skeletonAnimFrameIndex))]:null:t.kind==="heart"?e.heartFrames.length>0?e.heartFrames[Math.max(0,Math.min(e.heartFrames.length-1,e.heartAnimFrameIndex))]:null:e.coinFrames.length>0?e.coinFrames[Math.max(0,Math.min(e.coinFrames.length-1,e.coinAnimFrameIndex))]:e.coinFrameName,d=c?e.playerAtlas.frames[c]:void 0,p=d?.frame,g=d?.pivot||{x:.5,y:1};if(p){const m=C[t.kind],u=m.visualHeight,o=p.w/p.h*u,f=s-g.x*o+t.width*.5+(m.offsetX||0),l=h+t.height+(m.offsetY||0)-u*g.y,w=Math.round(f*e.scale),k=Math.round(l*e.scale+M),D=Math.max(1,Math.round(o*e.scale)),R=Math.max(1,Math.round(u*e.scale)),I=e.ctx.imageSmoothingEnabled;if(e.ctx.imageSmoothingEnabled=!1,e.ctx.drawImage(e.playerSprite,p.x,p.y,p.w,p.h,w,k,D,R),e.ctx.imageSmoothingEnabled=I,e.debugDrawHitboxes){const E=Math.round(s*e.scale),S=Math.round(h*e.scale+M),x=Math.round(t.width*e.scale),i=Math.round(t.height*e.scale);e.ctx.save(),e.ctx.globalAlpha=.3,e.ctx.fillStyle="#ff00ff",e.ctx.fillRect(E,S,x,i),e.ctx.globalAlpha=1,e.ctx.lineWidth=Math.max(1,Math.round(e.scale)),e.ctx.strokeStyle="#ff00ff",e.ctx.strokeRect(E,S,x,i),e.ctx.restore()}continue}}if(e.ctx.fillStyle=t.kind==="heart"?"#0a0":t.kind==="coin"?"#fc0":"red",e.ctx.fillRect(Math.round(s*e.scale),Math.round(h*e.scale+M),Math.round(t.width*e.scale),Math.round(t.height*e.scale)),e.debugDrawHitboxes){const c=Math.round(s*e.scale),d=Math.round(h*e.scale+M),p=Math.round(t.width*e.scale),g=Math.round(t.height*e.scale);e.ctx.save(),e.ctx.globalAlpha=.3,e.ctx.fillStyle="#ff00ff",e.ctx.fillRect(c,d,p,g),e.ctx.globalAlpha=1,e.ctx.lineWidth=Math.max(1,Math.round(e.scale)),e.ctx.strokeStyle="#ff00ff",e.ctx.strokeRect(c,d,p,g),e.ctx.restore()}}}function X(){r.ready||(r.ready=!0,postMessage({type:"ready"}))}let W=0,J=0;const P=1e3/60,z=100,se=5;function pe(e){if(!r.ready)return;W||(W=e);let a=e-W;W=e,a<0&&(a=0),a>z&&(a=z),J+=a;let y=0;for(;J>=P&&y<se;)re(r,P/1e3),J-=P,y++;r.uiElapsedMs+=a,r.uiDirty&&r.uiElapsedMs>=r.uiIntervalMs&&(postMessage({type:"ui",coinCount:r.coinCount,lifeCount:r.lifeCount}),r.uiDirty=!1,r.uiElapsedMs=0);const F=Math.max(0,Math.min(1,J/P));oe(r,F,P/1e3)}onmessage=e=>{const a=e.data||{};switch(a.type){case"init":{r.canvas=a.canvas,r.skyColor=typeof a.skyColor=="string"?a.skyColor:r.skyColor,r.expectResize=!!a.expectResize,r.debugDrawHitboxes=!!a.debugHitboxes;const y=!!a.alpha;if(r.ctx=r.canvas.getContext("2d",{alpha:y}),!r.ctx)return;r.ctx.imageSmoothingEnabled=!1,r.transparentBg=!!a.transparentBg,B(r,a.cssW,a.cssH,a.dpr),r.expectResize?(r.readyTimer&&clearTimeout(r.readyTimer),r.readyTimer=setTimeout(()=>{X()},200)):X();break}case"resize":{B(r,a.cssW,a.cssH,a.dpr),r.expectResize&&(r.expectResize=!1,r.readyTimer&&(clearTimeout(r.readyTimer),r.readyTimer=null),X());break}case"frame":{pe(typeof a.now=="number"?a.now:performance.now());break}case"vis":{W=0,J=0;break}case"input":{(a.tap||a.space)&&!r.isDying&&r.lifeCount>0&&(r.pendingJump=!0);break}}}})();
//# sourceMappingURL=worker.entry-DsFPW6C0.js.map
